<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Educador IA - BNCC Pro</title>
    <meta name="theme-color" content="#6366f1">
    <link rel="manifest" href="manifest.json">
    <link rel="apple-touch-icon" href="https://cdn-icons-png.flaticon.com/512/3426/3426653.png">

    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" rel="stylesheet">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap"
        rel="stylesheet">

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: { sans: ['Inter', 'system-ui', 'sans-serif'] },
                    colors: {
                        primary: { 50: '#eef2ff', 100: '#e0e7ff', 200: '#c7d2fe', 300: '#a5b4fc', 400: '#818cf8', 500: '#6366f1', 600: '#4f46e5', 700: '#4338ca', 800: '#3730a3', 900: '#312e81' },
                        accent: { 50: '#f0fdfa', 100: '#ccfbf1', 200: '#99f6e4', 300: '#5eead4', 400: '#2dd4bf', 500: '#14b8a6', 600: '#0d9488', 700: '#0f766e' },
                        surface: { 50: '#fafafa', 100: '#f4f4f5', 200: '#e4e4e7', 300: '#d4d4d8' }
                    }
                }
            }
        }
    </script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', system-ui, sans-serif;
            background: linear-gradient(135deg, #f8fafc 0%, #eef2ff 100%);
        }

        /* Custom Scrollbar */
        .scrollbar-thin::-webkit-scrollbar {
            width: 5px;
        }

        .scrollbar-thin::-webkit-scrollbar-track {
            background: transparent;
        }

        .scrollbar-thin::-webkit-scrollbar-thumb {
            background: linear-gradient(180deg, #a5b4fc, #818cf8);
            border-radius: 10px;
        }

        .scrollbar-thin::-webkit-scrollbar-thumb:hover {
            background: linear-gradient(180deg, #818cf8, #6366f1);
        }

        /* Sidebar Layout */
        #sidebar {
            display: flex;
            flex-direction: column;
            height: 100vh;
            max-height: 100vh;
            overflow: hidden;
        }

        #sidebar-header {
            flex-shrink: 0;
        }

        #toolList {
            flex-grow: 1;
            overflow-y: auto;
            min-height: 0;
        }

        #sidebar-footer {
            flex-shrink: 0;
        }

        /* Utilities */
        .hidden-screen {
            display: none !important;
        }

        /* Animations */
        .fade-in {
            animation: fadeIn 0.6s cubic-bezier(0.4, 0, 0.2, 1);
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .slide-up {
            animation: slideUp 0.5s cubic-bezier(0.4, 0, 0.2, 1);
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .scale-in {
            animation: scaleIn 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        @keyframes scaleIn {
            from {
                opacity: 0;
                transform: scale(0.95);
            }

            to {
                opacity: 1;
                transform: scale(1);
            }
        }

        /* Loader Animations */
        .pencil-loader {
            display: inline-block;
            font-size: 48px;
            background: linear-gradient(135deg, #6366f1, #8b5cf6);
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
            color: transparent;
            animation: writing 0.8s infinite alternate ease-in-out;
            transform-origin: bottom center;
        }

        @keyframes writing {
            0% {
                transform: rotate(-12deg) translateY(0);
            }

            100% {
                transform: rotate(12deg) translateY(-8px);
            }
        }

        .loader {
            width: 48px;
            height: 48px;
            border: 3px solid #e0e7ff;
            border-radius: 50%;
            border-top-color: #6366f1;
            animation: spin 0.8s linear infinite;
        }

        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }

        .pulse-ring {
            animation: pulseRing 1.5s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }

        @keyframes pulseRing {

            0%,
            100% {
                opacity: 1;
            }

            50% {
                opacity: 0.5;
            }
        }

        /* Glassmorphism */
        .glass {
            background: rgba(255, 255, 255, 0.8);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.3);
        }

        .glass-dark {
            background: rgba(99, 102, 241, 0.1);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
        }

        /* Gradient Text */
        .gradient-text {
            background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 50%, #a855f7 100%);
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
            color: transparent;
        }

        /* Button Hover Effects */
        .btn-primary {
            background: linear-gradient(135deg, #6366f1 0%, #4f46e5 100%);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 4px 14px 0 rgba(99, 102, 241, 0.39);
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px 0 rgba(99, 102, 241, 0.5);
        }

        .btn-primary:active {
            transform: translateY(0);
        }

        .btn-secondary {
            background: linear-gradient(135deg, #14b8a6 0%, #0d9488 100%);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 4px 14px 0 rgba(20, 184, 166, 0.39);
        }

        .btn-secondary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px 0 rgba(20, 184, 166, 0.5);
        }

        /* Card Hover */
        .card-hover {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .card-hover:hover {
            transform: translateY(-4px);
            box-shadow: 0 20px 40px -12px rgba(99, 102, 241, 0.25);
        }

        /* Tool Item */
        .tool-item {
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
            border-left: 3px solid transparent;
        }

        .tool-item:hover {
            background: linear-gradient(90deg, rgba(99, 102, 241, 0.08) 0%, transparent 100%);
            border-left-color: #6366f1;
        }

        .tool-item.active {
            background: linear-gradient(90deg, rgba(99, 102, 241, 0.12) 0%, transparent 100%);
            border-left-color: #6366f1;
        }

        /* Input Focus */
        .input-modern {
            transition: all 0.2s ease;
            border: 2px solid #e4e4e7;
        }

        .input-modern:focus {
            border-color: #6366f1;
            box-shadow: 0 0 0 4px rgba(99, 102, 241, 0.1);
            outline: none;
        }

        /* Markdown Content */
        .markdown-body h1 {
            font-size: 1.5em;
            font-weight: 700;
            background: linear-gradient(135deg, #4f46e5, #7c3aed);
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
            color: transparent;
            margin-bottom: 0.75em;
        }

        .markdown-body h2 {
            font-size: 1.25em;
            font-weight: 600;
            color: #4338ca;
            margin-top: 1.5em;
            margin-bottom: 0.5em;
        }

        .markdown-body h3 {
            font-size: 1.1em;
            font-weight: 600;
            color: #6366f1;
            margin-top: 1.25em;
            margin-bottom: 0.5em;
        }

        .markdown-body ul,
        .markdown-body ol {
            margin-left: 1.5em;
            margin-bottom: 1em;
        }

        .markdown-body li {
            margin-bottom: 0.5em;
            line-height: 1.7;
        }

        .markdown-body p {
            margin-bottom: 1em;
            line-height: 1.8;
            color: #374151;
        }

        .markdown-body strong {
            color: #1f2937;
            font-weight: 600;
        }

        .markdown-body code {
            background: #f3f4f6;
            padding: 0.2em 0.4em;
            border-radius: 4px;
            font-size: 0.9em;
        }

        /* Modal Backdrop */
        .modal-backdrop {
            background: rgba(15, 23, 42, 0.6);
            backdrop-filter: blur(8px);
        }

        /* INTRO OVERLAY */
        #introOverlay {
            position: fixed;
            inset: 0;
            z-index: 100;
            background: linear-gradient(135deg, #312e81 0%, #4c1d95 100%);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            transition: opacity 0.8s ease-out, visibility 0.8s;
        }

        .intro-logo {
            width: 120px;
            height: 120px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            animation: pulseLogo 2s infinite;
        }

        .intro-title {
            font-size: 2rem;
            font-weight: 800;
            color: white;
            margin-top: 1.5rem;
            letter-spacing: -0.02em;
            opacity: 0;
            transform: translateY(20px);
            animation: fadeInUp 0.8s ease-out forwards 0.5s;
        }

        .intro-subtitle {
            font-size: 0.875rem;
            color: rgba(255, 255, 255, 0.6);
            margin-top: 0.5rem;
            opacity: 0;
            transform: translateY(20px);
            animation: fadeInUp 0.8s ease-out forwards 0.8s;
        }

        @keyframes pulseLogo {
            0% {
                transform: scale(1);
                box-shadow: 0 0 0 0 rgba(255, 255, 255, 0.2);
            }

            70% {
                transform: scale(1.05);
                box-shadow: 0 0 0 20px rgba(255, 255, 255, 0);
            }

            100% {
                transform: scale(1);
                box-shadow: 0 0 0 0 rgba(255, 255, 255, 0);
            }
        }

        @keyframes fadeInUp {
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* FLOATING INSTALL BUTTON */
        .fab-install {
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 90;
            background: linear-gradient(135deg, #10b981, #059669);
            color: white;
            padding: 12px 24px;
            border-radius: 50px;
            font-weight: 600;
            box-shadow: 0 4px 15px rgba(16, 185, 129, 0.4);
            display: flex;
            align-items: center;
            gap: 8px;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            cursor: pointer;
            border: none;
        }

        .fab-install:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(16, 185, 129, 0.5);
        }

        .fab-install:active {
            transform: scale(0.95);
        }
    </style>
</head>

<body class="h-screen overflow-hidden">

    <!-- INTRO OVERLAY -->
    <div id="introOverlay">
        <div class="intro-logo">
            <i class="fas fa-graduation-cap text-5xl text-white"></i>
        </div>
        <h1 class="intro-title">Educador IA</h1>
        <p class="intro-subtitle">Potencializando o ensino com intelig√™ncia</p>
    </div>

    <!-- FLOATING INSTALL BUTTON -->
    <button id="fabInstall" class="fab-install hidden fade-in" onclick="triggerInstall()">
        <i class="fas fa-download"></i> Instalar App
    </button>

    <!-- iOS INSTALL MODAL -->
    <div id="iosInstallModal" class="fixed inset-0 modal-backdrop z-[60] hidden flex items-center justify-center p-4">
        <div class="bg-white rounded-3xl max-w-sm w-full p-6 text-center shadow-2xl scale-in">
            <i class="fab fa-apple text-4xl text-gray-800 mb-4"></i>
            <h3 class="text-xl font-bold text-gray-800 mb-2">Instalar no iOS</h3>
            <p class="text-gray-600 text-sm mb-6">Toque no bot√£o <i
                    class="fas fa-share-from-square text-primary-500 mx-1"></i> (Compartilhar) e depois em
                <br><strong>"Adicionar √† Tela de In√≠cio"</strong>.
            </p>
            <button onclick="document.getElementById('iosInstallModal').classList.add('hidden')"
                class="w-full bg-gray-900 text-white py-3 rounded-xl font-semibold">Entendi</button>
        </div>
    </div>
    <!-- MAIN APP -->
    <div id="mainApp" class="hidden-screen h-full flex overflow-hidden">

        <!-- Mobile Header -->
        <div class="md:hidden fixed top-0 w-full bg-white/80 backdrop-blur-xl text-gray-800 z-50 flex items-center justify-between px-4 py-3 border-b border-surface-200 shadow-sm"
            style="height: 64px;">
            <div class="flex items-center gap-3">
                <button onclick="returnToHome()"
                    class="w-10 h-10 flex items-center justify-center hover:bg-surface-100 rounded-xl transition-colors">
                    <i class="fas fa-home text-primary-600 text-lg"></i>
                </button>
                <div>
                    <h1 class="text-lg font-bold gradient-text">Educador IA</h1>
                    <p class="text-xs text-gray-500">BNCC Pro</p>
                </div>
            </div>
            <button id="mobileMenuBtn"
                class="w-10 h-10 flex items-center justify-center hover:bg-surface-100 rounded-xl transition-colors">
                <i class="fas fa-bars text-gray-600 text-xl"></i>
            </button>
        </div>

        <!-- Sidebar -->
        <aside id="sidebar"
            class="fixed inset-y-0 left-0 z-40 w-80 bg-white border-r border-surface-200 transform -translate-x-full md:translate-x-0 transition-transform duration-300 ease-out shadow-2xl md:shadow-sm pt-[64px] md:pt-0">

            <!-- Sidebar Header -->
            <div id="sidebar-header"
                class="p-6 bg-gradient-to-br from-primary-600 via-primary-700 to-purple-700 text-white relative overflow-hidden">
                <!-- Decorative Elements -->
                <div class="absolute top-0 right-0 w-32 h-32 bg-white/5 rounded-full -translate-y-1/2 translate-x-1/2">
                </div>
                <div
                    class="absolute bottom-0 left-0 w-24 h-24 bg-white/5 rounded-full translate-y-1/2 -translate-x-1/2">
                </div>

                <div class="relative">
                    <div class="flex justify-between items-start mb-5">
                        <div class="flex items-center gap-3">
                            <button onclick="returnToHome()"
                                class="w-10 h-10 bg-white/10 hover:bg-white/20 rounded-xl flex items-center justify-center transition-colors"
                                title="Voltar ao in√≠cio">
                                <i class="fas fa-home text-lg"></i>
                            </button>
                            <div>
                                <h1 class="text-xl font-bold">Educador IA</h1>
                                <p class="text-primary-200 text-xs font-medium">BNCC Pro Edition</p>
                            </div>
                        </div>
                        <button id="closeSidebarBtn"
                            class="md:hidden w-8 h-8 flex items-center justify-center text-white/70 hover:text-white hover:bg-white/10 rounded-lg transition-colors">
                            <i class="fas fa-times text-lg"></i>
                        </button>
                    </div>

                    <p class="text-primary-100 text-sm mb-5 leading-relaxed">Assistente pedag√≥gico inteligente com
                        suporte offline.</p>

                    <button id="installBtn"
                        class="hidden w-full mb-5 px-4 py-2.5 bg-white/15 hover:bg-white/25 text-white rounded-xl text-sm font-semibold transition-all flex items-center justify-center gap-2 border border-white/20">
                        <i class="fas fa-download"></i> Instalar App
                    </button>

                    <div class="relative">
                        <i class="fas fa-search absolute left-4 top-1/2 -translate-y-1/2 text-primary-300"></i>
                        <input type="search" id="searchInput" name="search_tools_unique_id" autocomplete="off"
                            class="w-full bg-white/10 border border-white/20 rounded-xl pl-11 pr-4 py-3 text-sm text-white placeholder-primary-200 focus:outline-none focus:bg-white/15 focus:border-white/30 transition-all"
                            placeholder="Buscar ferramenta...">
                    </div>
                </div>
            </div>

            <!-- Tool List -->
            <nav id="toolList" class="scrollbar-thin p-3 space-y-1"></nav>

            <!-- Sidebar Footer -->
            <div id="sidebar-footer" class="p-4 border-t border-surface-200 bg-surface-50 space-y-3">
                <button onclick="showGuideModal()"
                    class="w-full flex items-center justify-center gap-2 text-purple-700 bg-purple-50 hover:bg-purple-100 px-4 py-2.5 rounded-xl text-sm font-semibold transition-colors">
                    <i class="fas fa-book-reader"></i> Guia Did√°tico
                </button>

                <button onclick="showTutorialModal()"
                    class="w-full flex items-center justify-center gap-2 text-primary-700 bg-primary-50 hover:bg-primary-100 px-4 py-2.5 rounded-xl text-sm font-semibold transition-colors">
                    <i class="fas fa-question-circle"></i> Ajuda / Chaves API
                </button>

                <div class="pt-3 border-t border-surface-200 space-y-2">
                    <button onclick="showApiKeyModal()"
                        class="w-full text-center text-sm text-accent-600 font-semibold hover:text-accent-700 py-1 flex items-center justify-center gap-2">
                        <i class="fas fa-plug"></i> Configurar IA
                    </button>
                    <div class="flex items-center justify-between text-xs text-gray-400">
                        <span>¬© 2026 Educador IA Desenvolvido pelo Prof¬∫ S√©rgio Ara√∫jo</span>
                        <button id="logoutBtn" onclick="logout()"
                            class="text-red-400 hover:text-red-500 font-medium transition-colors">
                            <i class="fas fa-sign-out-alt mr-1"></i>Sair
                        </button>
                    </div>
                </div>
            </div>
        </aside>

        <!-- Overlay -->
        <div id="overlay" class="fixed inset-0 bg-black/40 backdrop-blur-sm z-30 hidden md:hidden transition-opacity">
        </div>
        <!-- Main Content -->
        <main
            class="flex-1 flex flex-col h-full w-full md:ml-80 pt-[64px] md:pt-0 bg-gradient-to-br from-surface-50 to-primary-50/30">

            <!-- Welcome State -->
            <div id="welcomeState"
                class="absolute inset-0 flex flex-col items-center justify-center text-center p-6 md:p-8 z-10 overflow-y-auto">
                <div class="max-w-2xl mx-auto slide-up">
                    <!-- Hero Icon -->
                    <div class="relative mb-8 inline-block">
                        <div
                            class="w-32 h-32 bg-gradient-to-br from-primary-100 to-purple-100 rounded-3xl flex items-center justify-center shadow-xl">
                            <i class="fas fa-graduation-cap text-5xl text-primary-600"></i>
                        </div>
                        <div
                            class="absolute -bottom-2 -right-2 w-12 h-12 bg-gradient-to-br from-accent-400 to-accent-500 rounded-2xl flex items-center justify-center shadow-lg">
                            <i class="fas fa-wand-magic-sparkles text-white text-lg"></i>
                        </div>
                    </div>

                    <h2 class="text-3xl md:text-4xl font-bold text-gray-800 mb-4">
                        Assistente Pedag√≥gico <span class="gradient-text">BNCC</span>
                    </h2>
                    <p class="text-gray-500 max-w-xl mx-auto mb-8 text-base md:text-lg leading-relaxed">
                        Crie conte√∫dos educacionais de alta qualidade com IA integrada ou gere prompts otimizados para
                        usar em qualquer plataforma.
                    </p>

                    <!-- API Warning -->
                    <div id="apiKeyWarning"
                        class="hidden mb-8 p-5 bg-amber-50 border border-amber-200 rounded-2xl max-w-md mx-auto text-left cursor-pointer hover:bg-amber-100 transition-all card-hover"
                        onclick="showTutorialModal()">
                        <div class="flex items-start gap-4">
                            <div
                                class="w-10 h-10 bg-amber-100 rounded-xl flex items-center justify-center flex-shrink-0">
                                <i class="fas fa-key text-amber-600"></i>
                            </div>
                            <div>
                                <p class="font-semibold text-amber-800 mb-1">Configura√ß√£o Necess√°ria</p>
                                <p class="text-sm text-amber-700">Clique aqui para aprender a criar sua Chave API
                                    gratuita e desbloquear todo o potencial da IA.</p>
                            </div>
                        </div>
                    </div>

                    <!-- Action Buttons -->
                    <div class="flex flex-col sm:flex-row gap-4 justify-center">
                        <button onclick="document.getElementById('mobileMenuBtn').click()"
                            class="md:hidden btn-primary text-white px-6 py-3.5 rounded-xl font-semibold">
                            <i class="fas fa-bars mr-2"></i>Abrir Menu
                        </button>
                        <button onclick="showPersonalizationModal()"
                            class="px-6 py-3.5 bg-white text-gray-700 rounded-xl font-semibold shadow-lg hover:shadow-xl transition-all border border-surface-200 hover:border-primary-200 card-hover">
                            <i class="fas fa-user-cog mr-2 text-primary-500"></i>Meus Dados
                        </button>
                        <button onclick="showApiKeyModal()"
                            class="btn-secondary text-white px-6 py-3.5 rounded-xl font-semibold">
                            <i class="fas fa-plug mr-2"></i>Conectar IA
                        </button>
                    </div>

                    <!-- Quick Stats -->
                    <div class="mt-12 grid grid-cols-3 gap-4 max-w-md mx-auto">
                        <div class="text-center p-4 bg-white/60 rounded-2xl border border-surface-200">
                            <div class="text-2xl font-bold text-primary-600">13</div>
                            <div class="text-xs text-gray-500 mt-1">Geradores</div>
                        </div>
                        <div class="text-center p-4 bg-white/60 rounded-2xl border border-surface-200">
                            <div class="text-2xl font-bold text-accent-600">6</div>
                            <div class="text-xs text-gray-500 mt-1">Provedores IA</div>
                        </div>
                        <div class="text-center p-4 bg-white/60 rounded-2xl border border-surface-200">
                            <div class="text-2xl font-bold text-purple-600">‚àû</div>
                            <div class="text-xs text-gray-500 mt-1">Possibilidades</div>
                        </div>
                    </div>
                </div>
            </div>
            <!-- Generator Container -->
            <div id="generatorContainer" class="hidden w-full h-full flex flex-col bg-white">
                <!-- Generator Header -->
                <div
                    class="bg-gradient-to-r from-primary-600 via-primary-700 to-purple-700 text-white p-6 md:p-8 relative overflow-hidden flex-shrink-0">
                    <div
                        class="absolute top-0 right-0 w-64 h-64 bg-white/5 rounded-full -translate-y-1/2 translate-x-1/2">
                    </div>
                    <div class="relative flex items-center justify-between flex-wrap gap-4">
                        <div class="flex items-center gap-5">
                            <div
                                class="w-14 h-14 bg-white/15 rounded-2xl flex items-center justify-center backdrop-blur-sm">
                                <i id="generatorIcon" class="fas fa-brain text-2xl"></i>
                            </div>
                            <div>
                                <h2 id="generatorTitle" class="text-2xl md:text-3xl font-bold">Gerador</h2>
                                <p id="generatorDescription" class="text-primary-100 text-sm mt-1">Descri√ß√£o</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Generator Form -->
                <div class="flex-1 overflow-y-auto p-6 md:p-8 bg-gradient-to-b from-surface-50 to-white">
                    <form id="generatorForm" class="max-w-4xl mx-auto space-y-6"></form>
                </div>

                <!-- Generator Footer -->
                <div class="bg-white border-t border-surface-200 p-5 md:p-6 flex-shrink-0 shadow-lg">
                    <div class="max-w-4xl mx-auto flex flex-col sm:flex-row gap-4 justify-between items-center">
                        <div class="text-sm text-gray-500 hidden sm:flex items-center gap-2" id="providerIndicator">
                            <div class="w-2 h-2 bg-surface-300 rounded-full"></div>
                            <span>Modo Padr√£o</span>
                        </div>
                        <div class="flex flex-wrap gap-3 w-full sm:w-auto justify-end">
                            <button type="button" onclick="resetForm()"
                                class="px-5 py-2.5 text-gray-600 hover:text-gray-800 bg-surface-100 hover:bg-surface-200 rounded-xl font-medium transition-colors">
                                <i class="fas fa-undo mr-2"></i>Limpar
                            </button>

                            <button type="button" onclick="handleGeneratePromptOnly()"
                                class="px-5 py-2.5 bg-white text-primary-600 border-2 border-primary-200 rounded-xl hover:bg-primary-50 hover:border-primary-300 font-semibold transition-all">
                                <i class="fas fa-copy mr-2"></i>Copiar Prompt
                            </button>

                            <button type="submit" form="generatorForm"
                                class="btn-primary text-white px-6 py-2.5 rounded-xl font-semibold">
                                <i class="fas fa-wand-magic-sparkles mr-2"></i>Gerar com IA
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>
    <!-- RESULT MODAL -->
    <div id="resultModal" class="fixed inset-0 modal-backdrop z-50 hidden flex items-center justify-center p-4">
        <div
            class="bg-white rounded-3xl shadow-2xl max-w-4xl w-full max-h-[90vh] flex flex-col scale-in overflow-hidden">
            <div
                class="bg-gradient-to-r from-primary-600 via-primary-700 to-purple-700 text-white p-5 md:p-6 flex items-center justify-between">
                <div class="flex items-center gap-4">
                    <div class="w-10 h-10 bg-white/15 rounded-xl flex items-center justify-center">
                        <i class="fas fa-sparkles text-lg"></i>
                    </div>
                    <h3 class="text-xl font-bold">Resultado Gerado</h3>
                </div>
                <button onclick="closeModal()"
                    class="w-10 h-10 flex items-center justify-center text-white/70 hover:text-white hover:bg-white/10 rounded-xl transition-colors">
                    <i class="fas fa-times text-xl"></i>
                </button>
            </div>

            <div class="flex-1 overflow-y-auto p-6 md:p-8 relative bg-surface-50">
                <div id="loadingState"
                    class="hidden absolute inset-0 bg-white flex flex-col items-center justify-center z-10">
                    <div class="loader mb-5"></div>
                    <p class="text-gray-700 font-semibold text-lg pulse-ring">A IA est√° pensando...</p>
                    <p class="text-sm text-gray-400 mt-2" id="loadingText">Consultando provedor...</p>
                </div>

                <div id="aiContent"
                    class="markdown-body text-gray-700 bg-white rounded-2xl p-6 md:p-8 shadow-sm border border-surface-200">
                </div>
            </div>

            <div class="p-5 md:p-6 border-t border-surface-200 bg-white flex justify-end gap-3">
                <button onclick="copyContent()"
                    class="px-5 py-2.5 bg-surface-100 hover:bg-surface-200 text-gray-700 rounded-xl font-medium transition-colors">
                    <i class="fas fa-copy mr-2"></i>Copiar Texto
                </button>
                <button onclick="closeModal()" class="btn-primary text-white px-6 py-2.5 rounded-xl font-semibold">
                    Fechar
                </button>
            </div>
        </div>
    </div>

    <!-- MASTER PROMPT MODAL -->
    <div id="masterPromptModal" class="fixed inset-0 modal-backdrop z-50 hidden flex items-center justify-center p-4">
        <div
            class="bg-white rounded-3xl shadow-2xl max-w-4xl w-full max-h-[90vh] flex flex-col scale-in overflow-hidden">
            <div
                class="bg-gradient-to-r from-purple-600 to-primary-600 text-white p-5 md:p-6 flex items-center justify-between">
                <div class="flex items-center gap-4">
                    <div class="w-10 h-10 bg-white/15 rounded-xl flex items-center justify-center">
                        <i class="fas fa-brain text-lg"></i>
                    </div>
                    <h3 class="text-xl font-bold">Prompt Mestre</h3>
                </div>
                <button onclick="closeMasterPrompt()"
                    class="w-10 h-10 flex items-center justify-center text-white/70 hover:text-white hover:bg-white/10 rounded-xl transition-colors">
                    <i class="fas fa-times text-xl"></i>
                </button>
            </div>
            <div class="flex-1 overflow-y-auto p-6 md:p-8 bg-surface-50">
                <div class="bg-white rounded-2xl p-6 border border-surface-200 shadow-sm">
                    <pre id="masterPromptText" class="text-sm text-gray-700 whitespace-pre-wrap leading-relaxed"></pre>
                </div>
            </div>
        </div>
    </div>
    <!-- PERSONALIZATION MODAL -->
    <div id="personalizationModal"
        class="fixed inset-0 modal-backdrop z-50 hidden flex items-center justify-center p-4">
        <div
            class="bg-white rounded-3xl shadow-2xl max-w-2xl w-full max-h-[90vh] flex flex-col scale-in overflow-hidden">
            <div
                class="bg-gradient-to-r from-purple-600 to-pink-600 text-white p-5 md:p-6 flex items-center justify-between">
                <div class="flex items-center gap-4">
                    <div class="w-10 h-10 bg-white/15 rounded-xl flex items-center justify-center">
                        <i class="fas fa-user-cog text-lg"></i>
                    </div>
                    <div>
                        <h3 class="text-xl font-bold">Personalizar Dados</h3>
                        <p class="text-purple-100 text-sm">Informa√ß√µes para contextualizar os conte√∫dos</p>
                    </div>
                </div>
                <button onclick="closePersonalizationModal()"
                    class="w-10 h-10 flex items-center justify-center text-white/70 hover:text-white hover:bg-white/10 rounded-xl transition-colors">
                    <i class="fas fa-times text-xl"></i>
                </button>
            </div>
            <div class="flex-1 overflow-y-auto p-6 md:p-8 bg-surface-50">
                <form id="personalizationForm" class="space-y-5">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-5">
                        <div class="space-y-2">
                            <label class="block text-sm font-semibold text-gray-700">Nome do(a) Professor(a)</label>
                            <input type="text" name="professorName"
                                class="w-full px-4 py-3 bg-white border-2 border-surface-200 rounded-xl input-modern"
                                placeholder="Seu nome completo">
                        </div>
                        <div class="space-y-2">
                            <label class="block text-sm font-semibold text-gray-700">Nome da Escola</label>
                            <input type="text" name="schoolName"
                                class="w-full px-4 py-3 bg-white border-2 border-surface-200 rounded-xl input-modern"
                                placeholder="Nome da institui√ß√£o">
                        </div>
                        <div class="space-y-2">
                            <label class="block text-sm font-semibold text-gray-700">Ano Letivo</label>
                            <input type="text" name="schoolYear"
                                class="w-full px-4 py-3 bg-white border-2 border-surface-200 rounded-xl input-modern"
                                placeholder="Ex: 2026">
                        </div>
                        <div class="space-y-2">
                            <label class="block text-sm font-semibold text-gray-700">Unidade Did√°tica</label>
                            <input type="text" name="didacticUnit"
                                class="w-full px-4 py-3 bg-white border-2 border-surface-200 rounded-xl input-modern"
                                placeholder="Ex: Unidade 1">
                        </div>
                    </div>
                </form>
            </div>
            <div class="p-5 md:p-6 border-t border-surface-200 bg-white">
                <div class="flex justify-end gap-3">
                    <button onclick="closePersonalizationModal()"
                        class="px-5 py-2.5 text-gray-600 hover:text-gray-800 bg-surface-100 hover:bg-surface-200 rounded-xl font-medium transition-colors">Cancelar</button>
                    <button onclick="savePersonalization()"
                        class="px-6 py-2.5 bg-gradient-to-r from-purple-600 to-pink-600 text-white rounded-xl font-semibold shadow-lg hover:shadow-xl transition-all">
                        <i class="fas fa-save mr-2"></i>Salvar Dados
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- API KEY MODAL -->
    <div id="apiKeyModal" class="fixed inset-0 modal-backdrop z-50 hidden flex items-center justify-center p-4">
        <div class="bg-white rounded-3xl shadow-2xl max-w-md w-full overflow-hidden scale-in">
            <div
                class="bg-gradient-to-r from-accent-500 to-accent-600 text-white p-5 flex justify-between items-center">
                <div class="flex items-center gap-3">
                    <div class="w-10 h-10 bg-white/15 rounded-xl flex items-center justify-center">
                        <i class="fas fa-plug text-lg"></i>
                    </div>
                    <h3 class="text-lg font-bold">Configurar API</h3>
                </div>
                <button onclick="document.getElementById('apiKeyModal').classList.add('hidden')"
                    class="w-8 h-8 flex items-center justify-center text-white/70 hover:text-white hover:bg-white/10 rounded-lg transition-colors">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="p-6 space-y-5">
                <div class="space-y-2">
                    <label class="block text-sm font-semibold text-gray-700">Provedor de IA</label>
                    <select id="providerSelect"
                        class="w-full px-4 py-3 bg-surface-50 border-2 border-surface-200 rounded-xl input-modern cursor-pointer"
                        onchange="toggleCustomFields()">
                        <option value="gemini">üåü Google Gemini (Gr√°tis)</option>
                        <option value="groq">‚ö° Groq (Gr√°tis/R√°pido)</option>
                        <option value="openai">ü§ñ OpenAI (GPT-4)</option>
                        <option value="deepseek">üîç DeepSeek</option>
                        <option value="anthropic">üß† Claude (Anthropic)</option>
                        <option value="openrouter">üåê OpenRouter (Universal)</option>
                    </select>
                </div>
                <div class="space-y-2">
                    <label class="block text-sm font-semibold text-gray-700">Chave API (Key)</label>
                    <div class="relative">
                        <i class="fas fa-key absolute left-4 top-1/2 -translate-y-1/2 text-gray-400"></i>
                        <input type="password" id="apiKeyInput"
                            class="w-full pl-11 pr-4 py-3 bg-surface-50 border-2 border-surface-200 rounded-xl input-modern"
                            placeholder="Cole sua chave aqui...">
                    </div>
                </div>
                <div id="customFields" class="hidden space-y-2">
                    <label class="block text-sm font-semibold text-gray-700">Modelo</label>
                    <input type="text" id="modelInput"
                        class="w-full px-4 py-3 bg-surface-50 border-2 border-surface-200 rounded-xl input-modern text-sm">
                </div>
            </div>
            <div class="p-5 border-t border-surface-200 bg-surface-50 flex justify-end gap-3">
                <button onclick="document.getElementById('apiKeyModal').classList.add('hidden')"
                    class="px-5 py-2.5 text-gray-600 hover:text-gray-800 font-medium transition-colors">Cancelar</button>
                <button onclick="saveApiConfig()" class="btn-secondary text-white px-6 py-2.5 rounded-xl font-semibold">
                    <i class="fas fa-check mr-2"></i>Salvar
                </button>
            </div>
        </div>
    </div>
    <!-- TUTORIAL MODAL -->
    <div id="tutorialModal" class="fixed inset-0 modal-backdrop z-50 hidden flex items-center justify-center p-4">
        <div
            class="bg-white rounded-3xl shadow-2xl max-w-3xl w-full max-h-[90vh] flex flex-col scale-in overflow-hidden">
            <div
                class="bg-gradient-to-r from-cyan-500 to-primary-600 text-white p-5 md:p-6 flex justify-between items-center">
                <div class="flex items-center gap-4">
                    <div class="w-10 h-10 bg-white/15 rounded-xl flex items-center justify-center">
                        <i class="fas fa-key text-lg"></i>
                    </div>
                    <div>
                        <h3 class="text-xl font-bold">Como obter a Chave API</h3>
                        <p class="text-cyan-100 text-sm">Guia passo a passo</p>
                    </div>
                </div>
                <button onclick="closeTutorialModal()"
                    class="w-10 h-10 flex items-center justify-center text-white/70 hover:text-white hover:bg-white/10 rounded-xl transition-colors">
                    <i class="fas fa-times text-xl"></i>
                </button>
            </div>

            <div class="flex-1 overflow-y-auto p-6 md:p-8 space-y-6 bg-surface-50">
                <div class="bg-gradient-to-r from-primary-50 to-cyan-50 p-5 rounded-2xl border border-primary-100">
                    <div class="flex items-start gap-4">
                        <div class="w-10 h-10 bg-primary-100 rounded-xl flex items-center justify-center flex-shrink-0">
                            <i class="fas fa-info-circle text-primary-600"></i>
                        </div>
                        <p class="text-primary-800 text-sm leading-relaxed"><strong>O que √© isso?</strong> √â uma "senha"
                            gratuita que conecta o app √† intelig√™ncia do Google ou outras IAs. Voc√™ cria uma vez e usa
                            para sempre.</p>
                    </div>
                </div>

                <div class="bg-white p-6 rounded-2xl border border-surface-200 shadow-sm">
                    <div class="flex items-center gap-3 mb-4">
                        <div class="w-8 h-8 bg-amber-100 rounded-lg flex items-center justify-center">
                            <span class="text-amber-600 font-bold">1</span>
                        </div>
                        <h4 class="font-bold text-gray-800 text-lg">Google Gemini (Recomendado)</h4>
                        <span
                            class="px-2 py-1 bg-green-100 text-green-700 text-xs font-semibold rounded-full">Gr√°tis</span>
                    </div>
                    <ol class="list-decimal ml-5 text-sm text-gray-600 space-y-2">
                        <li>Acesse <a href="https://aistudio.google.com/app/apikey" target="_blank"
                                class="text-primary-600 font-semibold hover:underline">Google AI Studio</a></li>
                        <li>Clique em <strong class="text-gray-800">Create API Key</strong></li>
                        <li>Copie o c√≥digo gerado e cole no app</li>
                    </ol>
                </div>

                <div class="bg-white p-6 rounded-2xl border border-surface-200 shadow-sm">
                    <div class="flex items-center gap-3 mb-4">
                        <div class="w-8 h-8 bg-amber-100 rounded-lg flex items-center justify-center">
                            <span class="text-amber-600 font-bold">2</span>
                        </div>
                        <h4 class="font-bold text-gray-800 text-lg">Groq (Muito R√°pido)</h4>
                        <span
                            class="px-2 py-1 bg-purple-100 text-purple-700 text-xs font-semibold rounded-full">R√°pido</span>
                    </div>
                    <ol class="list-decimal ml-5 text-sm text-gray-600 space-y-2">
                        <li>Acesse <a href="https://console.groq.com/keys" target="_blank"
                                class="text-primary-600 font-semibold hover:underline">Groq Console</a></li>
                        <li>Crie uma chave e cole no app</li>
                    </ol>
                </div>

                <div
                    class="bg-gradient-to-r from-purple-50 to-pink-50 p-5 rounded-2xl border border-purple-100 text-center">
                    <p class="text-sm text-gray-600">
                        Prefere gerar apenas o Prompt? Leve para o
                        <a href="https://claude.ai" target="_blank"
                            class="text-purple-600 font-bold hover:underline">claude.ai</a>
                        (testado e aprovado!)
                    </p>
                </div>
            </div>

            <div class="p-5 border-t border-surface-200 bg-white flex justify-end">
                <button onclick="closeTutorialModal()"
                    class="px-6 py-2.5 bg-gradient-to-r from-cyan-500 to-primary-600 text-white rounded-xl font-semibold shadow-lg hover:shadow-xl transition-all">
                    <i class="fas fa-check mr-2"></i>Entendi
                </button>
            </div>
        </div>
    </div>
    <!-- GUIDE MODAL -->
    <div id="guideModal" class="fixed inset-0 modal-backdrop z-50 hidden flex items-center justify-center p-4">
        <div
            class="bg-white rounded-3xl shadow-2xl max-w-4xl w-full max-h-[90vh] flex flex-col scale-in overflow-hidden">
            <div
                class="bg-gradient-to-r from-purple-600 via-indigo-600 to-primary-600 text-white p-5 md:p-6 flex justify-between items-center">
                <div class="flex items-center gap-4">
                    <div class="w-10 h-10 bg-white/15 rounded-xl flex items-center justify-center">
                        <i class="fas fa-book-reader text-lg"></i>
                    </div>
                    <div>
                        <h3 class="text-xl font-bold">Guia Did√°tico dos Geradores</h3>
                        <p class="text-purple-100 text-sm">Entenda o funcionamento pedag√≥gico de cada ferramenta</p>
                    </div>
                </div>
                <button onclick="closeGuideModal()"
                    class="w-10 h-10 flex items-center justify-center text-white/70 hover:text-white hover:bg-white/10 rounded-xl transition-colors">
                    <i class="fas fa-times text-xl"></i>
                </button>
            </div>

            <div class="flex-1 overflow-y-auto p-6 md:p-8 space-y-5 bg-surface-50">

                <!-- Avalia√ß√£o Formativa Mestre -->
                <div class="bg-white p-6 rounded-2xl shadow-sm border-l-4 border-amber-400 card-hover">
                    <div class="flex items-start gap-5">
                        <div
                            class="w-14 h-14 bg-gradient-to-br from-amber-100 to-amber-200 rounded-2xl flex items-center justify-center flex-shrink-0">
                            <i class="fas fa-star text-2xl text-amber-600"></i>
                        </div>
                        <div class="flex-1">
                            <h4 class="text-lg font-bold text-gray-800 mb-2">Avalia√ß√£o Formativa Mestre</h4>
                            <p class="text-sm text-gray-500 mb-4">Um construtor de provas e testes de alta complexidade
                                pedag√≥gica.</p>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-sm">
                                <div class="bg-surface-50 p-4 rounded-xl">
                                    <strong class="text-gray-700 block mb-2">Para que serve?</strong>
                                    <p class="text-gray-600 leading-relaxed">Para criar avalia√ß√µes que v√£o al√©m da
                                        memoriza√ß√£o. Utiliza a Taxonomia de Bloom para garantir que o aluno analise,
                                        compreenda e aplique o conhecimento.</p>
                                </div>
                                <div class="bg-surface-50 p-4 rounded-xl">
                                    <strong class="text-gray-700 block mb-2">Como usar:</strong>
                                    <p class="text-gray-600 leading-relaxed">No campo "Distribui√ß√£o Bloom", defina
                                        quantos n√≠veis voc√™ quer (ex: "2 Lembrar, 3 Analisar"). Detalhe bem o contexto
                                        da turma.</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Avalia√ß√£o Diagn√≥stica -->
                <div class="bg-white p-6 rounded-2xl shadow-sm border-l-4 border-emerald-400 card-hover">
                    <div class="flex items-start gap-5">
                        <div
                            class="w-14 h-14 bg-gradient-to-br from-emerald-100 to-emerald-200 rounded-2xl flex items-center justify-center flex-shrink-0">
                            <i class="fas fa-user-md text-2xl text-emerald-600"></i>
                        </div>
                        <div class="flex-1">
                            <h4 class="text-lg font-bold text-gray-800 mb-2">Avalia√ß√£o Diagn√≥stica (Sondagem)</h4>
                            <p class="text-sm text-gray-500 mb-4">Ferramenta para descobrir o que o aluno sabe antes de
                                come√ßar um conte√∫do novo.</p>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-sm">
                                <div class="bg-surface-50 p-4 rounded-xl">
                                    <strong class="text-gray-700 block mb-2">Para que serve?</strong>
                                    <p class="text-gray-600 leading-relaxed">Para identificar lacunas de aprendizagem de
                                        anos anteriores. O foco √© encontrar pr√©-requisitos n√£o consolidados.</p>
                                </div>
                                <div class="bg-surface-50 p-4 rounded-xl">
                                    <strong class="text-gray-700 block mb-2">Como usar:</strong>
                                    <p class="text-gray-600 leading-relaxed">O campo "S√©ries Anteriores" √© importante.
                                        Se seu aluno est√° no 8¬∫ ano, pe√ßa para sondar conte√∫dos do 6¬∫ e 7¬∫ ano.</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Plano de Aula -->
                <div class="bg-white p-6 rounded-2xl shadow-sm border-l-4 border-primary-400 card-hover">
                    <div class="flex items-start gap-5">
                        <div
                            class="w-14 h-14 bg-gradient-to-br from-primary-100 to-primary-200 rounded-2xl flex items-center justify-center flex-shrink-0">
                            <i class="fas fa-chalkboard-teacher text-2xl text-primary-600"></i>
                        </div>
                        <div class="flex-1">
                            <h4 class="text-lg font-bold text-gray-800 mb-2">Plano de Aula</h4>
                            <p class="text-sm text-gray-500 mb-4">O roteiro detalhado para um dia letivo ou um encontro
                                espec√≠fico.</p>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-sm">
                                <div class="bg-surface-50 p-4 rounded-xl">
                                    <strong class="text-gray-700 block mb-2">Para que serve?</strong>
                                    <p class="text-gray-600 leading-relaxed">Organizar o tempo, definir a metodologia e
                                        garantir que a aula tenha in√≠cio, meio e fim alinhados √† BNCC.</p>
                                </div>
                                <div class="bg-surface-50 p-4 rounded-xl">
                                    <strong class="text-gray-700 block mb-2">Como usar:</strong>
                                    <p class="text-gray-600 leading-relaxed">Seja espec√≠fico na dura√ß√£o (ex: 50 min). No
                                        campo metodologia, escolha se quer uma aula expositiva ou ativa.</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- Sequ√™ncia Did√°tica -->
                <div class="bg-white p-6 rounded-2xl shadow-sm border-l-4 border-purple-400 card-hover">
                    <div class="flex items-start gap-5">
                        <div
                            class="w-14 h-14 bg-gradient-to-br from-purple-100 to-purple-200 rounded-2xl flex items-center justify-center flex-shrink-0">
                            <i class="fas fa-list-ol text-2xl text-purple-600"></i>
                        </div>
                        <div class="flex-1">
                            <h4 class="text-lg font-bold text-gray-800 mb-2">Sequ√™ncia Did√°tica</h4>
                            <p class="text-sm text-gray-500 mb-4">Um conjunto de aulas encadeadas sobre o mesmo tema.
                            </p>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-sm">
                                <div class="bg-surface-50 p-4 rounded-xl">
                                    <strong class="text-gray-700 block mb-2">Para que serve?</strong>
                                    <p class="text-gray-600 leading-relaxed">Para aprofundar um assunto que n√£o cabe em
                                        uma s√≥ aula. Permite evolu√ß√£o gradual da dificuldade.</p>
                                </div>
                                <div class="bg-surface-50 p-4 rounded-xl">
                                    <strong class="text-gray-700 block mb-2">Como usar:</strong>
                                    <p class="text-gray-600 leading-relaxed">Defina o n√∫mero de aulas (ex: 5 aulas). A
                                        IA ir√° dividir o conte√∫do: introdu√ß√£o, desenvolvimento e conclus√£o.</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Projeto Did√°tico -->
                <div class="bg-white p-6 rounded-2xl shadow-sm border-l-4 border-orange-400 card-hover">
                    <div class="flex items-start gap-5">
                        <div
                            class="w-14 h-14 bg-gradient-to-br from-orange-100 to-orange-200 rounded-2xl flex items-center justify-center flex-shrink-0">
                            <i class="fas fa-project-diagram text-2xl text-orange-600"></i>
                        </div>
                        <div class="flex-1">
                            <h4 class="text-lg font-bold text-gray-800 mb-2">Projeto Did√°tico</h4>
                            <p class="text-sm text-gray-500 mb-4">Um trabalho de longo prazo, geralmente
                                interdisciplinar, focado em resolver um problema real.</p>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-sm">
                                <div class="bg-surface-50 p-4 rounded-xl">
                                    <strong class="text-gray-700 block mb-2">Para que serve?</strong>
                                    <p class="text-gray-600 leading-relaxed">Engajar alunos na constru√ß√£o de um "Produto
                                        Final" (ex: uma feira, um livro, um v√≠deo). √ìtimo para feiras de ci√™ncias.</p>
                                </div>
                                <div class="bg-surface-50 p-4 rounded-xl">
                                    <strong class="text-gray-700 block mb-2">Como usar:</strong>
                                    <p class="text-gray-600 leading-relaxed">O campo "Problema" √© vital. Defina uma
                                        quest√£o instigante (ex: "Como reduzir o lixo na escola?").</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Outras Ferramentas -->
                <div class="bg-white p-6 rounded-2xl shadow-sm border border-surface-200">
                    <h4 class="text-lg font-bold text-gray-800 mb-5 flex items-center gap-3">
                        <div
                            class="w-10 h-10 bg-gradient-to-br from-gray-100 to-gray-200 rounded-xl flex items-center justify-center">
                            <i class="fas fa-toolbox text-gray-600"></i>
                        </div>
                        Outras Ferramentas R√°pidas
                    </h4>
                    <div class="grid grid-cols-1 sm:grid-cols-2 gap-4 text-sm">
                        <div class="bg-surface-50 p-4 rounded-xl">
                            <strong class="text-primary-700 flex items-center gap-2 mb-1"><i class="fas fa-book"></i>
                                Plano de Curso:</strong>
                            <p class="text-gray-600">Planejamento macro (anual ou semestral). Divide o ano em 3 grandes
                                unidades.</p>
                        </div>
                        <div class="bg-surface-50 p-4 rounded-xl">
                            <strong class="text-primary-700 flex items-center gap-2 mb-1"><i
                                    class="fas fa-layer-group"></i> Plano de Unidade:</strong>
                            <p class="text-gray-600">Planejamento m√©dio. Foca em um cap√≠tulo ou tema espec√≠fico do
                                bimestre.</p>
                        </div>
                        <div class="bg-surface-50 p-4 rounded-xl">
                            <strong class="text-primary-700 flex items-center gap-2 mb-1"><i class="fas fa-tasks"></i>
                                Atividade:</strong>
                            <p class="text-gray-600">Gera um exerc√≠cio √∫nico e pr√°tico para sala de aula ou casa.</p>
                        </div>
                        <div class="bg-surface-50 p-4 rounded-xl">
                            <strong class="text-primary-700 flex items-center gap-2 mb-1"><i
                                    class="fas fa-clipboard-check"></i> Avalia√ß√£o Simples:</strong>
                            <p class="text-gray-600">Cria provas tradicionais, rubricas ou roteiros de observa√ß√£o.</p>
                        </div>
                        <div class="bg-surface-50 p-4 rounded-xl">
                            <strong class="text-primary-700 flex items-center gap-2 mb-1"><i
                                    class="fas fa-question-circle"></i> Quiz:</strong>
                            <p class="text-gray-600">Perguntas r√°pidas de m√∫ltipla escolha para revis√£o ou gamifica√ß√£o.
                            </p>
                        </div>
                        <div class="bg-surface-50 p-4 rounded-xl">
                            <strong class="text-primary-700 flex items-center gap-2 mb-1"><i class="fas fa-gamepad"></i>
                                Jogo Educativo:</strong>
                            <p class="text-gray-600">Cria regras e mec√¢nicas para transformar o conte√∫do em brincadeira.
                            </p>
                        </div>
                        <div class="bg-surface-50 p-4 rounded-xl col-span-1 sm:col-span-2">
                            <strong class="text-primary-700 flex items-center gap-2 mb-1"><i
                                    class="fas fa-globe-americas"></i> Temas Transversais:</strong>
                            <p class="text-gray-600">Insere temas sociais (meio ambiente, √©tica) dentro da sua
                                disciplina padr√£o.</p>
                        </div>
                    </div>
                </div>

            </div>

            <div class="p-5 border-t border-surface-200 bg-white flex justify-end">
                <button onclick="closeGuideModal()"
                    class="px-6 py-2.5 bg-gradient-to-r from-purple-600 to-primary-600 text-white rounded-xl font-semibold shadow-lg hover:shadow-xl transition-all">
                    <i class="fas fa-check mr-2"></i>Entendi, obrigado!
                </button>
            </div>
        </div>
    </div>
    <script>
        // -----------------------------------------------------
        // 1. DADOS & PROMPT MESTRE
        // -----------------------------------------------------
        const MASTER_PROMPT = `Voc√™ √© um especialista em educa√ß√£o e BNCC (Base Nacional Comum Curricular). Sua fun√ß√£o √© criar conte√∫dos educacionais de alta qualidade que estejam perfeitamente alinhados com as compet√™ncias e habilidades da BNCC.

DIRETRIZES OBRIGAT√ìRIAS:
1. ALINHAMENTO BNCC: Sempre referencie as compet√™ncias gerais e espec√≠ficas da BNCC e c√≥digos de habilidades.
2. QUALIDADE PEDAG√ìGICA: Use metodologias ativas e diversificadas.
3. INCLUS√ÉO E DIVERSIDADE: Considere a diversidade cultural e acessibilidade.
4. CONTEXTUALIZA√á√ÉO: Conecte com a realidade dos estudantes.
5. ESTRUTURA CLARA: Objetivos de aprendizagem, sequ√™ncia did√°tica e avalia√ß√£o.

Sempre que criar qualquer conte√∫do educacional, certifique-se de que est√° contribuindo para o desenvolvimento das 10 compet√™ncias gerais da BNCC.`;

        const generators = [
            {
                id: 'plano-curso',
                icon: 'fa-book',
                title: 'Plano de Curso',
                description: 'Planejamento anual ou semestral (3 Unidades)',
                fields: [
                    { type: 'select', name: 'etapa', label: 'Etapa de Ensino', required: true, options: ['Educa√ß√£o Infantil', 'Ensino Fundamental I', 'Ensino Fundamental II', 'Ensino M√©dio'] },
                    { type: 'text', name: 'serie', label: 'S√©rie/Ano', required: true, placeholder: 'Ex: 9¬∫ ano' },
                    { type: 'select', name: 'area', label: '√Årea do Conhecimento', required: true, options: ['Linguagens', 'Matem√°tica', 'Ci√™ncias da Natureza', 'Ci√™ncias Humanas', 'Ensino Religioso'] },
                    { type: 'text', name: 'disciplina', label: 'Disciplina', required: true, placeholder: 'Ex: Hist√≥ria, Literatura' },
                    { type: 'select', name: 'periodo', label: 'Per√≠odo', required: true, options: ['Anual', 'Semestral', 'Bimestral', 'Trimestral'] },
                    { type: 'textarea', name: 'ementa', label: 'Ementa/Foco Principal', placeholder: 'Resumo do que ser√° abordado no curso' },
                    { type: 'textarea', name: 'metodologia_geral', label: 'Metodologia Geral', placeholder: 'Ex: Ensino H√≠brido, Pedagogia de Projetos' }
                ],
                prompt: (data) => `${MASTER_PROMPT}\nCrie um Plano de Curso detalhado:\nEtapa: ${data.etapa}\nS√©rie: ${data.serie}\n√Årea: ${data.area}\nDisciplina: ${data.disciplina}\nPeriodicidade: ${data.periodo}\nEmenta: ${data.ementa}\nMetodologia: ${data.metodologia_geral}\n\nIMPORTANTE: A Organiza√ß√£o Curricular deve ser DIVIDIDA EM EXATAMENTE 3 UNIDADES, independentemente da dura√ß√£o.`
            },
            {
                id: 'plano-unidade',
                icon: 'fa-layer-group',
                title: 'Plano de Unidade',
                description: 'Planeje uma unidade tem√°tica espec√≠fica',
                fields: [
                    { type: 'select', name: 'etapa', label: 'Etapa', required: true, options: ['Ed. Infantil', 'Fund. I', 'Fund. II', 'M√©dio'] },
                    { type: 'text', name: 'serie', label: 'S√©rie', required: true },
                    { type: 'text', name: 'disciplina', label: 'Disciplina', required: true },
                    { type: 'text', name: 'titulo_unidade', label: 'T√≠tulo da Unidade', required: true },
                    { type: 'number', name: 'num_aulas', label: 'N¬∫ Aulas', placeholder: '10' },
                    { type: 'textarea', name: 'objetivos_unidade', label: 'Objetivos', required: true },
                    { type: 'textarea', name: 'estrategias', label: 'Estrat√©gias' }
                ],
                prompt: (data) => `${MASTER_PROMPT}\nDesenvolva um Plano de Unidade:\nS√©rie: ${data.serie}\nDisciplina: ${data.disciplina}\nT√≠tulo: ${data.titulo_unidade}\nAulas: ${data.num_aulas}\nObjetivos: ${data.objetivos_unidade}\nEstrat√©gias: ${data.estrategias}\n\nEstrutura: Contextualiza√ß√£o, Habilidades BNCC, Cronograma e Avalia√ß√£o.`
            },
            {
                id: 'plano-aula',
                icon: 'fa-chalkboard-teacher',
                title: 'Plano de Aula',
                description: 'Crie planos de aula detalhados alinhados √† BNCC',
                fields: [
                    { type: 'select', name: 'etapa', label: 'Etapa de Ensino', required: true, options: ['Educa√ß√£o Infantil', 'Ensino Fundamental I', 'Ensino Fundamental II', 'Ensino M√©dio'] },
                    { type: 'text', name: 'serie', label: 'S√©rie/Ano', required: true, placeholder: 'Ex: 5¬∫ ano, 1¬™ s√©rie' },
                    { type: 'select', name: 'area', label: '√Årea do Conhecimento', required: true, options: ['Linguagens', 'Matem√°tica', 'Ci√™ncias da Natureza', 'Ci√™ncias Humanas', 'Ensino Religioso'] },
                    { type: 'text', name: 'disciplina', label: 'Disciplina', required: true, placeholder: 'Ex: L√≠ngua Portuguesa, Hist√≥ria' },
                    { type: 'text', name: 'tema', label: 'Tema da Aula', required: true, placeholder: 'Ex: Sistema Solar, Fra√ß√µes' },
                    { type: 'number', name: 'duracao', label: 'Dura√ß√£o (minutos)', required: true, placeholder: '50' },
                    { type: 'textarea', name: 'objetivos', label: 'Objetivos Espec√≠ficos', placeholder: 'Descreva os objetivos de aprendizagem' },
                    { type: 'textarea', name: 'recursos', label: 'Recursos Dispon√≠veis', placeholder: 'Materiais, tecnologias, espa√ßos' },
                    { type: 'select', name: 'metodologia', label: 'Metodologia Principal', options: ['Aula Expositiva', 'Aprendizagem Baseada em Problemas', 'Sala de Aula Invertida', 'Gamifica√ß√£o', 'Projeto', 'Estudo de Caso'] }
                ],
                prompt: (data) => `${MASTER_PROMPT}\nCrie um plano de aula completo:\nEtapa: ${data.etapa}\nS√©rie: ${data.serie}\n√Årea: ${data.area}\nDisciplina: ${data.disciplina}\nTema: ${data.tema}\nDura√ß√£o: ${data.duracao} min\nMetodologia: ${data.metodologia}\nObjetivos: ${data.objetivos}\nRecursos: ${data.recursos}\n\nEstrutura: Identifica√ß√£o, Habilidades BNCC, Sequ√™ncia Did√°tica detalhada, Avalia√ß√£o e Refer√™ncias.`
            },
            {
                id: 'atividade',
                icon: 'fa-tasks',
                title: 'Atividade Pedag√≥gica',
                description: 'Desenvolva atividades pr√°ticas e envolventes',
                fields: [
                    { type: 'select', name: 'etapa', label: 'Etapa de Ensino', required: true, options: ['Educa√ß√£o Infantil', 'Ensino Fundamental I', 'Ensino Fundamental II', 'Ensino M√©dio'] },
                    { type: 'text', name: 'serie', label: 'S√©rie/Ano', required: true },
                    { type: 'select', name: 'area', label: '√Årea do Conhecimento', required: true, options: ['Linguagens', 'Matem√°tica', 'Ci√™ncias da Natureza', 'Ci√™ncias Humanas', 'Ensino Religioso'] },
                    { type: 'text', name: 'tema', label: 'Tema/Conte√∫do', required: true },
                    { type: 'select', name: 'tipo', label: 'Tipo de Atividade', options: ['Individual', 'Dupla', 'Grupo', 'Coletiva'] },
                    { type: 'number', name: 'tempo', label: 'Tempo Estimado (min)', placeholder: '30' },
                    { type: 'textarea', name: 'objetivo', label: 'Objetivo da Atividade', placeholder: 'O que os alunos devem aprender/desenvolver' },
                    { type: 'select', name: 'dificuldade', label: 'N√≠vel de Dificuldade', options: ['B√°sico', 'Intermedi√°rio', 'Avan√ßado'] }
                ],
                prompt: (data) => `${MASTER_PROMPT}\nDesenvolva uma atividade pedag√≥gica:\nEtapa: ${data.etapa}\nS√©rie: ${data.serie}\n√Årea: ${data.area}\nTema: ${data.tema}\nTipo: ${data.tipo}\nTempo: ${data.tempo} min\nN√≠vel: ${data.dificuldade}\nObjetivo: ${data.objetivo}\n\nEstrutura: Identifica√ß√£o, Habilidades BNCC, Instru√ß√µes passo a passo, Crit√©rios de Avalia√ß√£o e Adapta√ß√µes.`
            },
            {
                id: 'avaliacao',
                icon: 'fa-clipboard-check',
                title: 'Avalia√ß√£o',
                description: 'Crie instrumentos de avalia√ß√£o alinhados √† BNCC',
                fields: [
                    { type: 'select', name: 'etapa', label: 'Etapa de Ensino', required: true, options: ['Educa√ß√£o Infantil', 'Ensino Fundamental I', 'Ensino Fundamental II', 'Ensino M√©dio'] },
                    { type: 'text', name: 'serie', label: 'S√©rie/Ano', required: true },
                    { type: 'select', name: 'area', label: '√Årea do Conhecimento', required: true, options: ['Linguagens', 'Matem√°tica', 'Ci√™ncias da Natureza', 'Ci√™ncias Humanas', 'Ensino Religioso'] },
                    { type: 'text', name: 'conteudo', label: 'Conte√∫do Avaliado', required: true },
                    { type: 'select', name: 'tipo', label: 'Tipo de Avalia√ß√£o', options: ['Diagn√≥stica', 'Formativa', 'Somativa', 'Autoavalia√ß√£o', 'Avalia√ß√£o por Pares'] },
                    { type: 'select', name: 'formato', label: 'Formato', options: ['Prova Escrita', 'Prova Oral', 'Projeto', 'Portf√≥lio', 'Apresenta√ß√£o', 'Relat√≥rio', 'Mapa Mental'] },
                    { type: 'number', name: 'questoes', label: 'N√∫mero de Quest√µes', placeholder: '10' },
                    { type: 'textarea', name: 'criterios', label: 'Crit√©rios Espec√≠ficos', placeholder: 'Aspectos importantes a serem avaliados' }
                ],
                prompt: (data) => `${MASTER_PROMPT}\nDesenvolva um instrumento de avalia√ß√£o:\nEtapa: ${data.etapa}\nS√©rie: ${data.serie}\n√Årea: ${data.area}\nConte√∫do: ${data.conteudo}\nTipo: ${data.tipo}\nFormato: ${data.formato}\nQuest√µes: ${data.questoes}\nCrit√©rios: ${data.criterios}\n\nEstrutura: Habilidades BNCC, Quest√µes/Atividades contextualizadas, Crit√©rios de Corre√ß√£o e Feedback.`
            },
            {
                id: 'projeto',
                icon: 'fa-project-diagram',
                title: 'Projeto Did√°tico',
                description: 'Desenvolva projetos interdisciplinares',
                fields: [
                    { type: 'select', name: 'etapa', label: 'Etapa de Ensino', required: true, options: ['Educa√ß√£o Infantil', 'Ensino Fundamental I', 'Ensino Fundamental II', 'Ensino M√©dio'] },
                    { type: 'text', name: 'serie', label: 'S√©rie/Ano', required: true },
                    { type: 'text', name: 'tema', label: 'Tema do Projeto', required: true },
                    { type: 'textarea', name: 'areas', label: '√Åreas Envolvidas', placeholder: 'Ex: Portugu√™s, Hist√≥ria, Geografia' },
                    { type: 'select', name: 'duracao', label: 'Dura√ß√£o', options: ['1 semana', '2 semanas', '1 m√™s', '1 bimestre', '1 semestre'] },
                    { type: 'textarea', name: 'problema', label: 'Problema/Quest√£o Norteadora', placeholder: 'Qual problema o projeto vai resolver?' },
                    { type: 'textarea', name: 'produto', label: 'Produto Final', placeholder: 'O que ser√° produzido/apresentado' },
                    { type: 'select', name: 'metodologia', label: 'Metodologia', options: ['Aprendizagem Baseada em Projetos', 'Design Thinking', 'Metodologia Cient√≠fica', 'STEAM'] }
                ],
                prompt: (data) => `${MASTER_PROMPT}\nDesenvolva um projeto did√°tico interdisciplinar:\nEtapa: ${data.etapa}\nS√©rie: ${data.serie}\nTema: ${data.tema}\n√Åreas: ${data.areas}\nDura√ß√£o: ${data.duracao}\nProblema: ${data.problema}\nProduto: ${data.produto}\nMetodologia: ${data.metodologia}\n\nEstrutura: Justificativa, Compet√™ncias BNCC, Cronograma, Recursos, Produto Final e Avalia√ß√£o.`
            },
            {
                id: 'sequencia',
                icon: 'fa-list-ol',
                title: 'Sequ√™ncia Did√°tica',
                description: 'Planeje sequ√™ncias de aulas articuladas',
                fields: [
                    { type: 'select', name: 'etapa', label: 'Etapa de Ensino', required: true, options: ['Educa√ß√£o Infantil', 'Ensino Fundamental I', 'Ensino Fundamental II', 'Ensino M√©dio'] },
                    { type: 'text', name: 'serie', label: 'S√©rie/Ano', required: true },
                    { type: 'select', name: 'area', label: '√Årea do Conhecimento', required: true, options: ['Linguagens', 'Matem√°tica', 'Ci√™ncias da Natureza', 'Ci√™ncias Humanas', 'Ensino Religioso'] },
                    { type: 'text', name: 'tema', label: 'Tema Central', required: true },
                    { type: 'number', name: 'aulas', label: 'N√∫mero de Aulas', required: true, placeholder: '5' },
                    { type: 'number', name: 'duracao', label: 'Dura√ß√£o de cada aula (min)', placeholder: '50' },
                    { type: 'textarea', name: 'objetivo', label: 'Objetivo Geral da Sequ√™ncia', required: true },
                    { type: 'textarea', name: 'conhecimentos', label: 'Conhecimentos Pr√©vios', placeholder: 'O que os alunos j√° sabem sobre o tema' }
                ],
                prompt: (data) => `${MASTER_PROMPT}\nDesenvolva uma sequ√™ncia did√°tica:\nEtapa: ${data.etapa}\nS√©rie: ${data.serie}\n√Årea: ${data.area}\nTema: ${data.tema}\nAulas: ${data.aulas}\nDura√ß√£o: ${data.duracao} min\nObjetivo: ${data.objetivo}\nConhecimentos pr√©vios: ${data.conhecimentos}\n\nEstrutura: Habilidades BNCC, Desenvolvimento detalhado aula a aula, Avalia√ß√£o Processual e Refer√™ncias.`
            },
            {
                id: 'quiz',
                icon: 'fa-question-circle',
                title: 'Quiz Educativo',
                description: 'Crie quizzes interativos para fixa√ß√£o',
                fields: [
                    { type: 'select', name: 'etapa', label: 'Etapa de Ensino', required: true, options: ['Educa√ß√£o Infantil', 'Ensino Fundamental I', 'Ensino Fundamental II', 'Ensino M√©dio'] },
                    { type: 'text', name: 'serie', label: 'S√©rie/Ano', required: true },
                    { type: 'select', name: 'area', label: '√Årea do Conhecimento', required: true, options: ['Linguagens', 'Matem√°tica', 'Ci√™ncias da Natureza', 'Ci√™ncias Humanas', 'Ensino Religioso'] },
                    { type: 'text', name: 'tema', label: 'Tema/Conte√∫do', required: true },
                    { type: 'number', name: 'questoes', label: 'N√∫mero de Quest√µes', required: true, placeholder: '10' },
                    { type: 'select', name: 'dificuldade', label: 'N√≠vel de Dificuldade', options: ['F√°cil', 'M√©dio', 'Dif√≠cil', 'Misto'] },
                    { type: 'select', name: 'tipo', label: 'Tipo de Quest√µes', options: ['M√∫ltipla Escolha', 'Verdadeiro/Falso', 'Completar', 'Misto'] },
                    { type: 'textarea', name: 'objetivo', label: 'Objetivo do Quiz', placeholder: 'Revisar, fixar, diagnosticar...' }
                ],
                prompt: (data) => `${MASTER_PROMPT}\nCrie um quiz educativo:\nEtapa: ${data.etapa}\nS√©rie: ${data.serie}\n√Årea: ${data.area}\nTema: ${data.tema}\nQuest√µes: ${data.questoes}\nDificuldade: ${data.dificuldade}\nTipo: ${data.tipo}\nObjetivo: ${data.objetivo}\n\nEstrutura: Habilidades BNCC, Quest√µes numeradas com gabarito e explica√ß√£o.`
            },
            {
                id: 'jogo',
                icon: 'fa-gamepad',
                title: 'Jogo Educativo',
                description: 'Desenvolva jogos para aprendizagem l√∫dica',
                fields: [
                    { type: 'select', name: 'etapa', label: 'Etapa de Ensino', required: true, options: ['Educa√ß√£o Infantil', 'Ensino Fundamental I', 'Ensino Fundamental II', 'Ensino M√©dio'] },
                    { type: 'text', name: 'serie', label: 'S√©rie/Ano', required: true },
                    { type: 'select', name: 'area', label: '√Årea do Conhecimento', required: true, options: ['Linguagens', 'Matem√°tica', 'Ci√™ncias da Natureza', 'Ci√™ncias Humanas', 'Ensino Religioso'] },
                    { type: 'text', name: 'tema', label: 'Tema/Conte√∫do', required: true },
                    { type: 'select', name: 'tipo', label: 'Tipo de Jogo', options: ['Tabuleiro', 'Cartas', 'Digital', 'Movimento', 'Quebra-cabe√ßa', 'RPG Educativo'] },
                    { type: 'number', name: 'jogadores', label: 'N√∫mero de Jogadores', placeholder: '4' },
                    { type: 'number', name: 'tempo', label: 'Tempo de Jogo (min)', placeholder: '30' },
                    { type: 'textarea', name: 'objetivo', label: 'Objetivo Pedag√≥gico', required: true }
                ],
                prompt: (data) => `${MASTER_PROMPT}\nDesenvolva um jogo educativo:\nEtapa: ${data.etapa}\nS√©rie: ${data.serie}\n√Årea: ${data.area}\nTema: ${data.tema}\nTipo: ${data.tipo}\nJogadores: ${data.jogadores}\nTempo: ${data.tempo} min\nObjetivo: ${data.objetivo}\n\nEstrutura: Regras, Materiais, Mec√¢nica do Jogo, Varia√ß√µes e Dicas para o Professor.`
            },
            {
                id: 'temas-transversais',
                icon: 'fa-globe-americas',
                title: 'Temas Contempor√¢neos Transversais',
                description: 'Desenvolva atividades com temas transversais da BNCC',
                fields: [
                    { type: 'select', name: 'tipo_conteudo', label: 'Tipo de Conte√∫do', required: true, options: ['Atividade', 'Plano de Aula', 'Sequ√™ncia Did√°tica', 'Projeto Did√°tico'] },
                    { type: 'select', name: 'etapa', label: 'Etapa de Ensino', required: true, options: ['Educa√ß√£o Infantil', 'Ensino Fundamental I', 'Ensino Fundamental II', 'Ensino M√©dio'] },
                    { type: 'text', name: 'serie', label: 'S√©rie/Ano', required: true },
                    { type: 'select', name: 'tema', label: 'Tema Transversal', required: true, options: ['Direitos Humanos', 'Educa√ß√£o Ambiental', 'Educa√ß√£o Alimentar', 'Educa√ß√£o Financeira', 'Educa√ß√£o Fiscal', 'Trabalho', 'Ci√™ncia e Tecnologia', 'Diversidade Cultural', 'Educa√ß√£o para o Tr√¢nsito', 'Sa√∫de', 'Vida Familiar e Social', 'Educa√ß√£o para o Consumo', 'Processo de Envelhecimento', 'Respeito e Valoriza√ß√£o do Idoso', 'Preserva√ß√£o do Meio Ambiente'] },
                    { type: 'select', name: 'area', label: '√Årea Principal', required: true, options: ['Linguagens', 'Matem√°tica', 'Ci√™ncias da Natureza', 'Ci√™ncias Humanas', 'Ensino Religioso'] },
                    { type: 'textarea', name: 'contexto', label: 'Contexto Local/Regional', placeholder: 'Descreva aspectos da realidade local que podem ser explorados' },
                    { type: 'select', name: 'metodologia', label: 'Metodologia', options: ['Projeto', 'Debate', 'Pesquisa', 'Estudo de Caso', 'Simula√ß√£o', 'Campanha', 'Feira de Conhecimentos'] },
                    { type: 'number', name: 'duracao', label: 'Dura√ß√£o (aulas)', placeholder: '4' },
                    { type: 'textarea', name: 'objetivo', label: 'Objetivo Espec√≠fico', placeholder: 'O que pretende desenvolver com este tema transversal' }
                ],
                prompt: (data) => `${MASTER_PROMPT}\nDesenvolva um(a) ${data.tipo_conteudo} sobre Tema Transversal:\nTema: ${data.tema}\nEtapa: ${data.etapa}\nS√©rie: ${data.serie}\n√Årea: ${data.area}\nContexto: ${data.contexto}\nMetodologia: ${data.metodologia}\nDura√ß√£o: ${data.duracao} aulas\nObjetivo: ${data.objetivo}\n\nImportante: Trabalhe de forma integrada, promovendo reflex√£o cr√≠tica e cidadania.`
            },
            {
                id: 'av-diagnostica',
                icon: 'fa-user-md',
                title: 'Avalia√ß√£o Diagn√≥stica (Sondagem)',
                description: 'Identifique lacunas de aprendizagem de anos anteriores',
                fields: [
                    { type: 'select', name: 'etapa', label: 'Etapa de Ensino', required: true, options: ['Educa√ß√£o Infantil', 'Ensino Fundamental I', 'Ensino Fundamental II', 'Ensino M√©dio'] },
                    { type: 'text', name: 'serie', label: 'S√©rie/Ano Atual', required: true, placeholder: 'Ex: 8¬∫ ano' },
                    { type: 'select', name: 'area', label: '√Årea do Conhecimento', required: true, options: ['Linguagens', 'Matem√°tica', 'Ci√™ncias da Natureza', 'Ci√™ncias Humanas', 'Ensino Religioso'] },
                    { type: 'text', name: 'disciplina', label: 'Disciplina', required: true, placeholder: 'Ex: Matem√°tica' },
                    { type: 'text', name: 'series_anteriores', label: 'S√©ries Anteriores para Sondar', required: true, placeholder: 'Ex: 6¬∫ e 7¬∫ ano' },
                    { type: 'textarea', name: 'conteudos', label: 'Conte√∫dos/Habilidades a Sondar', required: true, placeholder: 'Ex: Opera√ß√µes com fra√ß√µes, equa√ß√µes de 1¬∫ grau...' },
                    { type: 'number', name: 'questoes', label: 'N√∫mero de Quest√µes', placeholder: '10' },
                    { type: 'select', name: 'formato', label: 'Formato das Quest√µes', options: ['M√∫ltipla Escolha', 'Dissertativas Curtas', 'Misto', 'Resolu√ß√£o de Problemas'] },
                    { type: 'textarea', name: 'contexto', label: 'Contexto da Turma', placeholder: 'Ex: Turma heterog√™nea, alunos com dificuldades em leitura...' }
                ],
                prompt: (data) => `${MASTER_PROMPT}\n\nCrie uma AVALIA√á√ÉO DIAGN√ìSTICA (SONDAGEM) completa:\n\nCONTEXTO:\n- Etapa: ${data.etapa}\n- S√©rie Atual: ${data.serie}\n- √Årea: ${data.area}\n- Disciplina: ${data.disciplina}\n- S√©ries Anteriores para Sondar: ${data.series_anteriores}\n- Conte√∫dos/Habilidades: ${data.conteudos}\n- N√∫mero de Quest√µes: ${data.questoes}\n- Formato: ${data.formato}\n- Contexto da Turma: ${data.contexto}\n\nOBJETIVO:\nIdentificar LACUNAS DE APRENDIZAGEM e PR√â-REQUISITOS N√ÉO CONSOLIDADOS de anos anteriores, permitindo ao professor planejar interven√ß√µes pedag√≥gicas adequadas.\n\nESTRUTURA OBRIGAT√ìRIA:\n1. Cabe√ßalho com identifica√ß√£o\n2. Instru√ß√µes claras para o aluno\n3. Quest√µes organizadas por habilidade/conte√∫do sondado\n4. Para cada quest√£o, indicar:\n   - Habilidade BNCC relacionada\n   - S√©rie de origem do conte√∫do\n   - N√≠vel cognitivo (Lembrar/Compreender/Aplicar)\n5. Gabarito comentado\n6. Matriz de an√°lise para o professor (tabela para registrar acertos/erros por habilidade)\n7. Sugest√µes de interven√ß√£o para cada lacuna identificada\n\nIMPORTANTE:\n- Foque em habilidades B√ÅSICAS e FUNDAMENTAIS\n- Evite quest√µes de n√≠veis cognitivos altos (Analisar, Avaliar, Criar)\n- Use linguagem acess√≠vel e contextualizada\n- Inclua quest√µes de diferentes n√≠veis de dificuldade dentro do b√°sico`
            },
            {
                id: 'av-formativa-mestre',
                icon: 'fa-star',
                title: 'Avalia√ß√£o Formativa Mestre',
                description: 'Gera avalia√ß√µes avan√ßadas baseadas na Taxonomia de Bloom',
                fields: [
                    { type: 'text', name: 'nivel', label: 'N√≠vel de Ensino', required: true, placeholder: 'Ex: Ensino Fundamental II (9¬∫ ano)' },
                    { type: 'text', name: 'area', label: '√Årea/Disciplina', required: true, placeholder: 'Ex: Hist√≥ria / Geografia' },
                    { type: 'text', name: 'unidade', label: 'Unidade Tem√°tica', required: true, placeholder: 'Ex: A Era Vargas' },
                    { type: 'textarea', name: 'objetivos', label: 'Objetivos de Aprendizagem (Habilidades)', required: true },
                    { type: 'textarea', name: 'contexto', label: 'Contexto Educacional', placeholder: 'Ex: Escola Rural, turma heterog√™nea...' },
                    { type: 'number', name: 'quantidade', label: 'Quantidade de Quest√µes', required: true, placeholder: '5' },
                    { type: 'text', name: 'tipos', label: 'Tipos de Quest√µes', placeholder: 'Ex: 2 M√∫ltipla Escolha, 1 Estudo de Caso' },
                    { type: 'text', name: 'bloom', label: 'Distribui√ß√£o Bloom', placeholder: 'Ex: 1 Lembrar, 2 Analisar, 2 Criar' },
                    { type: 'text', name: 'dificuldade', label: 'N√≠veis de Dificuldade', placeholder: 'Ex: 2 B√°sicas, 2 Intermedi√°rias, 1 Avan√ßada' },
                    { type: 'text', name: 'idioma', label: 'Idioma', placeholder: 'Portugu√™s Brasileiro', required: true }
                ],
                prompt: (data) => `Voc√™ √© um ESPECIALISTA EM AVALIA√á√ÉO EDUCACIONAL, DID√ÅTICA, CURR√çCULO E CI√äNCIAS DA APRENDIZAGEM, com dom√≠nio da Taxonomia de Bloom (revisada), avalia√ß√£o formativa e integridade acad√™mica.

OBJETIVO:
Criar uma AVALIA√á√ÉO FORMATIVA AVAN√áADA, pedag√≥gica e cientificamente fundamentada, alinhada √† unidade acad√™mica, ao conte√∫do curricular e aos objetivos de aprendizagem informados abaixo.

ENTRADAS DO USU√ÅRIO (CONTEXTO DA AVALIA√á√ÉO):
1. N√≠vel de ensino: ${data.nivel}
2. √Årea do conhecimento / disciplina: ${data.area}
3. Unidade tem√°tica / conte√∫do espec√≠fico: ${data.unidade}
4. Objetivos de aprendizagem: ${data.objetivos}
5. Contexto educacional: ${data.contexto}
6. Quantidade total de quest√µes: ${data.quantidade}
7. Tipos de quest√µes desejados: ${data.tipos}
8. Distribui√ß√£o Taxonomia de Bloom: ${data.bloom}
9. N√≠veis de dificuldade: ${data.dificuldade}
10. Idioma da avalia√ß√£o: ${data.idioma}

DIRETRIZES OBRIGAT√ìRIAS:
- Todas as quest√µes DEVEM ser de natureza FORMATIVA (diagn√≥stica ou reguladora da aprendizagem).
- As perguntas devem avaliar PROCESSOS COGNITIVOS, n√£o apenas memoriza√ß√£o.
- Cada quest√£o deve indicar explicitamente:
  a) N√≠vel da Taxonomia de Bloom
  b) N√≠vel de dificuldade
  c) Habilidade cognitiva avaliada
- As quest√µes devem variar em complexidade e abordagem.
- Utilizar linguagem adequada ao n√≠vel de ensino informado.
- Contextualizar sempre que poss√≠vel (situa√ß√µes reais, problemas sociais, cient√≠ficos ou culturais).

ESTRUTURA OBRIGAT√ìRIA PARA CADA QUEST√ÉO:
1. Enunciado da quest√£o
2. Tipo de quest√£o
3. N√≠vel da Taxonomia de Bloom
4. Grau de dificuldade
5. Objetivo pedag√≥gico da quest√£o
6. Gabarito ou resposta esperada
7. Justificativa pedag√≥gica da resposta
8. Fonte confi√°vel utilizada (livro, artigo acad√™mico, documento oficial, site institucional, etc.)

EXIG√äNCIAS ACAD√äMICAS:
- As fontes DEVEM ser reais, confi√°veis e verific√°veis.
- Evitar fontes gen√©ricas ou n√£o acad√™micas.
- N√£o inventar refer√™ncias.
- Quando aplic√°vel, priorizar documentos curriculares oficiais, livros did√°ticos reconhecidos e artigos cient√≠ficos.

FORMATO DE SA√çDA:
- Organizar a avalia√ß√£o de forma clara, numerada e bem estruturada.
- Utilizar subt√≠tulos.
- Manter consist√™ncia terminol√≥gica e pedag√≥gica.

RESTRI√á√ïES:
- N√ÉO simplificar excessivamente o conte√∫do.
- N√ÉO gerar quest√µes vagas ou amb√≠guas.
- N√ÉO repetir estruturas de perguntas.
- N√ÉO criar avalia√ß√µes meramente conteudistas.

CRIT√âRIO DE QUALIDADE:
A avalia√ß√£o deve permitir ao professor identificar:
- Quais conhecimentos pr√©vios foram consolidados
- Quais est√£o parcialmente constru√≠dos
- Quais n√£o foram constru√≠dos
permitindo planejamento de recupera√ß√£o, refor√ßo ou reensino.

Agora, gere a avalia√ß√£o de sondagem com base nas informa√ß√µes fornecidas.`
            }
        ];
        // -----------------------------------------------------
        // 2. L√≥gica de Login REMOVIDA
        // -----------------------------------------------------

        function triggerInstall() {
            const isIOS = /iPad|iPhone|iPod/.test(navigator.userAgent) && !window.MSStream;
            if (isIOS) {
                document.getElementById('iosInstallModal').classList.remove('hidden');
                return;
            }
            if (!deferredPrompt) return;
            deferredPrompt.prompt();
            deferredPrompt.userChoice.then((choiceResult) => {
                if (choiceResult.outcome === 'accepted') {
                    document.getElementById('fabInstall').classList.add('hidden');
                    document.getElementById('installBtn').classList.add('hidden');
                }
            });
        }

        // -----------------------------------------------------
        // 3. ESTADO & UI (SIDEBAR & NAVEGA√á√ÉO)
        // -----------------------------------------------------
        let personalizationData = JSON.parse(localStorage.getItem('personalizationData')) || {};
        let apiConfig = JSON.parse(localStorage.getItem('apiConfig')) || { provider: 'gemini', key: '', model: '' };
        let currentGenerator = null;
        let activeLink = null;

        const sidebar = document.getElementById('sidebar');
        const overlay = document.getElementById('overlay');
        const generatorContainer = document.getElementById('generatorContainer');
        const welcomeState = document.getElementById('welcomeState');
        const toolList = document.getElementById('toolList');
        const generatorForm = document.getElementById('generatorForm');

        function toggleSidebar() {
            const isClosed = sidebar.classList.contains('-translate-x-full');
            if (isClosed) { sidebar.classList.remove('-translate-x-full'); overlay.classList.remove('hidden'); }
            else { sidebar.classList.add('-translate-x-full'); overlay.classList.add('hidden'); }
        }

        function returnToHome() {
            generatorContainer.classList.add('hidden');
            welcomeState.classList.remove('hidden');
            if (window.innerWidth < 768) { sidebar.classList.add('-translate-x-full'); overlay.classList.add('hidden'); }
            currentGenerator = null;
        }

        function renderList(filter = '') {
            toolList.innerHTML = '';
            const filtered = generators.filter(g => g.title.toLowerCase().includes(filter.toLowerCase()));
            filtered.forEach(generator => {
                const btn = document.createElement('button');
                btn.className = 'tool-item w-full text-left px-4 py-3.5 flex items-center gap-4 text-sm font-medium text-gray-600 group rounded-xl';
                btn.innerHTML = `
                    <div class="w-11 h-11 rounded-xl bg-gradient-to-br from-surface-100 to-surface-200 flex items-center justify-center group-hover:from-primary-100 group-hover:to-primary-200 transition-all duration-300 shadow-sm">
                        <i class="fas ${generator.icon} text-gray-500 group-hover:text-primary-600 transition-colors"></i>
                    </div>
                    <div class="flex-1 min-w-0">
                        <div class="font-semibold text-gray-700 group-hover:text-primary-700 truncate transition-colors">${generator.title}</div>
                        <div class="text-xs text-gray-400 truncate mt-0.5">${generator.description}</div>
                    </div>
                    <i class="fas fa-chevron-right text-gray-300 group-hover:text-primary-400 transition-colors"></i>
                `;
                btn.onclick = () => showGenerator(generator, btn);
                toolList.appendChild(btn);
            });
        }

        function showGenerator(generator, element) {
            currentGenerator = generator;
            if (activeLink) { activeLink.classList.remove('active', 'bg-primary-50'); }
            if (element) { element.classList.add('active', 'bg-primary-50'); activeLink = element; }

            document.getElementById('generatorIcon').className = `fas ${generator.icon} text-2xl`;
            document.getElementById('generatorTitle').textContent = generator.title;
            document.getElementById('generatorDescription').textContent = generator.description;

            buildForm(generator.fields);

            welcomeState.classList.add('hidden');
            generatorContainer.classList.remove('hidden');
            if (window.innerWidth < 768) toggleSidebar();
        }

        function buildForm(fields) {
            generatorForm.innerHTML = '';
            fields.forEach(field => {
                const div = document.createElement('div');
                div.className = 'space-y-2';
                const label = document.createElement('label');
                label.className = 'block text-sm font-semibold text-gray-700';
                label.textContent = field.label + (field.required ? ' *' : '');

                let input;
                if (field.type === 'select') {
                    input = document.createElement('select');
                    input.className = 'w-full px-4 py-3 bg-white border-2 border-surface-200 rounded-xl input-modern cursor-pointer';
                    const def = document.createElement('option'); def.value = ''; def.textContent = 'Selecione...'; input.appendChild(def);
                    field.options.forEach(opt => { const o = document.createElement('option'); o.value = opt; o.textContent = opt; input.appendChild(o); });
                } else if (field.type === 'textarea') {
                    input = document.createElement('textarea');
                    input.className = 'w-full px-4 py-3 bg-white border-2 border-surface-200 rounded-xl input-modern resize-none';
                    input.rows = 3;
                } else {
                    input = document.createElement('input');
                    input.type = field.type;
                    input.className = 'w-full px-4 py-3 bg-white border-2 border-surface-200 rounded-xl input-modern';
                }
                input.name = field.name;
                if (field.required) input.required = true;
                if (field.placeholder) input.placeholder = field.placeholder;
                div.appendChild(label); div.appendChild(input); generatorForm.appendChild(div);
            });
        }
        // -----------------------------------------------------
        // 4. API & GENERATION LOGIC
        // -----------------------------------------------------
        const resultModal = document.getElementById('resultModal');
        const loadingState = document.getElementById('loadingState');
        const aiContent = document.getElementById('aiContent');
        const loadingText = document.getElementById('loadingText');

        function updateProviderIndicator() {
            const div = document.getElementById('providerIndicator');
            const warn = document.getElementById('apiKeyWarning');
            if (apiConfig.key && apiConfig.key.length > 5) {
                div.innerHTML = `<div class="w-2 h-2 bg-emerald-500 rounded-full animate-pulse"></div><span class="text-emerald-600 font-medium">Conectado: ${apiConfig.provider}</span>`;
                warn.classList.add('hidden');
            } else {
                div.innerHTML = `<div class="w-2 h-2 bg-amber-500 rounded-full"></div><span class="text-amber-600">Sem conex√£o</span>`;
                warn.classList.remove('hidden');
            }
        }

        function handleGeneratePromptOnly() {
            if (!currentGenerator) return;
            const formData = new FormData(generatorForm);
            const data = {};
            for (let [key, value] of formData.entries()) data[key] = value;

            let userPrompt = currentGenerator.prompt(data);
            if (Object.keys(personalizationData).length > 0) {
                let context = "\n\nCONTEXTO DO PROFESSOR:\n";
                if (personalizationData.professorName) context += `- Nome: ${personalizationData.professorName}\n`;
                if (personalizationData.schoolName) context += `- Escola: ${personalizationData.schoolName}\n`;
                if (personalizationData.didacticUnit) context += `- Unidade: ${personalizationData.didacticUnit}\n`;
                userPrompt += context;
            }
            const fullPrompt = `${MASTER_PROMPT}\n\n${userPrompt}`;

            resultModal.classList.remove('hidden');
            loadingState.classList.add('hidden');
            aiContent.innerHTML = `
                <div class="bg-gradient-to-r from-primary-50 to-purple-50 border border-primary-100 p-5 rounded-xl mb-6">
                    <div class="flex items-start gap-4">
                        <div class="w-10 h-10 bg-primary-100 rounded-xl flex items-center justify-center flex-shrink-0">
                            <i class="fas fa-copy text-primary-600"></i>
                        </div>
                        <div>
                            <p class="font-semibold text-primary-800 mb-1">Prompt Gerado com Sucesso!</p>
                            <p class="text-sm text-primary-600">Copie o texto abaixo e cole na sua IA de prefer√™ncia (ChatGPT, Claude, Gemini, etc.)</p>
                        </div>
                    </div>
                </div>
                <pre id="promptTextToCopy" class="whitespace-pre-wrap text-sm text-gray-700 font-mono bg-surface-50 p-5 rounded-xl border border-surface-200 max-h-80 overflow-y-auto leading-relaxed">${fullPrompt}</pre>
                <div class="mt-4 flex justify-end">
                    <button onclick="copyToClipboard(document.getElementById('promptTextToCopy').innerText)" class="px-5 py-2.5 bg-primary-100 hover:bg-primary-200 text-primary-700 rounded-xl font-semibold transition-colors">
                        <i class="fas fa-copy mr-2"></i>Copiar Prompt
                    </button>
                </div>
            `;
        }

        async function handleGenerate(e) {
            e.preventDefault();
            if (!currentGenerator) return;
            if (!apiConfig.key) { showApiKeyModal(); return; }

            const formData = new FormData(generatorForm);
            const data = {};
            for (let [key, value] of formData.entries()) data[key] = value;

            let userPrompt = currentGenerator.prompt(data);
            if (Object.keys(personalizationData).length > 0) {
                userPrompt += `\n\nCONTEXTO: ${personalizationData.professorName || ''}, ${personalizationData.schoolName || ''}`;
            }

            resultModal.classList.remove('hidden');
            loadingState.classList.remove('hidden');
            aiContent.innerHTML = '';
            loadingText.textContent = `Consultando ${apiConfig.provider}...`;

            try {
                let responseText = "";
                if (apiConfig.provider === 'gemini') {
                    const model = apiConfig.model || "gemini-1.5-flash";
                    const res = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/${model}:generateContent?key=${apiConfig.key}`, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ contents: [{ parts: [{ text: MASTER_PROMPT + "\n\n" + userPrompt }] }] }) });
                    const d = await res.json();
                    if (d.error) throw new Error(d.error.message);
                    responseText = d.candidates[0].content.parts[0].text;
                } else if (apiConfig.provider === 'groq') {
                    const model = apiConfig.model || "llama-3.3-70b-versatile";
                    const res = await fetch('https://api.groq.com/openai/v1/chat/completions', { method: 'POST', headers: { 'Content-Type': 'application/json', 'Authorization': `Bearer ${apiConfig.key}` }, body: JSON.stringify({ model: model, messages: [{ role: "system", content: MASTER_PROMPT }, { role: "user", content: userPrompt }], temperature: 0.7 }) });
                    const d = await res.json();
                    if (d.error) throw new Error(d.error.message);
                    responseText = d.choices[0].message.content;
                } else if (apiConfig.provider === 'openai') {
                    const res = await fetch('https://api.openai.com/v1/chat/completions', { method: 'POST', headers: { 'Content-Type': 'application/json', 'Authorization': `Bearer ${apiConfig.key}` }, body: JSON.stringify({ model: "gpt-4o-mini", messages: [{ role: "system", content: MASTER_PROMPT }, { role: "user", content: userPrompt }] }) });
                    const d = await res.json();
                    if (d.error) throw new Error(d.error.message);
                    responseText = d.choices[0].message.content;
                } else if (apiConfig.provider === 'deepseek') {
                    const res = await fetch('https://api.deepseek.com/chat/completions', { method: 'POST', headers: { 'Content-Type': 'application/json', 'Authorization': `Bearer ${apiConfig.key}` }, body: JSON.stringify({ model: "deepseek-chat", messages: [{ role: "system", content: MASTER_PROMPT }, { role: "user", content: userPrompt }] }) });
                    const d = await res.json();
                    if (d.error) throw new Error(d.error.message);
                    responseText = d.choices[0].message.content;
                } else if (apiConfig.provider === 'anthropic') {
                    const res = await fetch('https://api.anthropic.com/v1/messages', { method: 'POST', headers: { 'x-api-key': apiConfig.key, 'anthropic-version': '2023-06-01', 'content-type': 'application/json', 'anthropic-dangerous-direct-browser-access': 'true' }, body: JSON.stringify({ model: "claude-3-5-sonnet-20240620", max_tokens: 4000, system: MASTER_PROMPT, messages: [{ role: "user", content: userPrompt }] }) });
                    const d = await res.json();
                    if (d.error) throw new Error(d.error.message);
                    responseText = d.content[0].text;
                } else if (apiConfig.provider === 'openrouter') {
                    const res = await fetch('https://openrouter.ai/api/v1/chat/completions', { method: 'POST', headers: { 'Content-Type': 'application/json', 'Authorization': `Bearer ${apiConfig.key}`, 'HTTP-Referer': window.location.href }, body: JSON.stringify({ model: apiConfig.model || "anthropic/claude-3.5-sonnet", messages: [{ role: "system", content: MASTER_PROMPT }, { role: "user", content: userPrompt }] }) });
                    const d = await res.json();
                    if (d.error) throw new Error(d.error.message);
                    responseText = d.choices[0].message.content;
                }

                aiContent.innerHTML = marked.parse(responseText);
            } catch (error) {
                aiContent.innerHTML = `<div class="bg-red-50 p-5 rounded-xl border border-red-100"><div class="flex items-start gap-4"><div class="w-10 h-10 bg-red-100 rounded-xl flex items-center justify-center flex-shrink-0"><i class="fas fa-exclamation-triangle text-red-600"></i></div><div><p class="font-semibold text-red-800 mb-1">Erro na Requisi√ß√£o</p><p class="text-sm text-red-600">${error.message}</p></div></div></div>`;
            } finally {
                loadingState.classList.add('hidden');
            }
        }
        // -----------------------------------------------------
        // 5. UTILS & MODALS
        // -----------------------------------------------------
        function resetForm() { generatorForm.reset(); }
        function closeModal() { document.getElementById('resultModal').classList.add('hidden'); }
        function closeMasterPrompt() { document.getElementById('masterPromptModal').classList.add('hidden'); }
        function copyToClipboard(text) {
            navigator.clipboard.writeText(text).then(() => {
                const toast = document.createElement('div');
                toast.className = 'fixed bottom-6 right-6 bg-gray-800 text-white px-5 py-3 rounded-xl shadow-lg z-50 flex items-center gap-3 slide-up';
                toast.innerHTML = '<i class="fas fa-check-circle text-emerald-400"></i><span>Copiado para a √°rea de transfer√™ncia!</span>';
                document.body.appendChild(toast);
                setTimeout(() => toast.remove(), 3000);
            });
        }
        function copyContent() { copyToClipboard(aiContent.innerText); }

        function showTutorialModal() { document.getElementById('tutorialModal').classList.remove('hidden'); }
        function closeTutorialModal() { document.getElementById('tutorialModal').classList.add('hidden'); }

        function showGuideModal() { document.getElementById('guideModal').classList.remove('hidden'); }
        function closeGuideModal() { document.getElementById('guideModal').classList.add('hidden'); }

        function showApiKeyModal() {
            document.getElementById('apiKeyInput').value = apiConfig.key;
            document.getElementById('providerSelect').value = apiConfig.provider;
            document.getElementById('modelInput').value = apiConfig.model;
            toggleCustomFields();
            document.getElementById('apiKeyModal').classList.remove('hidden');
        }
        function toggleCustomFields() {
            const p = document.getElementById('providerSelect').value;
            const m = document.getElementById('modelInput');
            if (p === 'groq') m.value = 'llama-3.3-70b-versatile';
            else if (p === 'gemini') m.value = 'gemini-1.5-flash';
            else if (p === 'deepseek') m.value = 'deepseek-chat';
            if (['groq', 'deepseek', 'anthropic', 'openrouter', 'gemini'].includes(p)) document.getElementById('customFields').classList.remove('hidden');
            else document.getElementById('customFields').classList.add('hidden');
        }
        function saveApiConfig() {
            const p = document.getElementById('providerSelect').value;
            const k = document.getElementById('apiKeyInput').value.trim();
            const m = document.getElementById('modelInput').value.trim();
            if (!k) {
                const toast = document.createElement('div');
                toast.className = 'fixed bottom-6 right-6 bg-red-600 text-white px-5 py-3 rounded-xl shadow-lg z-50 flex items-center gap-3 slide-up';
                toast.innerHTML = '<i class="fas fa-exclamation-circle"></i><span>Chave API √© obrigat√≥ria!</span>';
                document.body.appendChild(toast);
                setTimeout(() => toast.remove(), 3000);
                return;
            }
            apiConfig = { provider: p, key: k, model: m };
            localStorage.setItem('apiConfig', JSON.stringify(apiConfig));
            document.getElementById('apiKeyModal').classList.add('hidden');
            updateProviderIndicator();
            const toast = document.createElement('div');
            toast.className = 'fixed bottom-6 right-6 bg-emerald-600 text-white px-5 py-3 rounded-xl shadow-lg z-50 flex items-center gap-3 slide-up';
            toast.innerHTML = '<i class="fas fa-check-circle"></i><span>Configura√ß√£o salva com sucesso!</span>';
            document.body.appendChild(toast);
            setTimeout(() => toast.remove(), 3000);
        }

        function showPersonalizationModal() {
            const form = document.getElementById('personalizationForm');
            Object.keys(personalizationData).forEach(k => { if (form[k]) form[k].value = personalizationData[k]; });
            document.getElementById('personalizationModal').classList.remove('hidden');
        }
        function closePersonalizationModal() { document.getElementById('personalizationModal').classList.add('hidden'); }
        function savePersonalization() {
            const fd = new FormData(document.getElementById('personalizationForm'));
            personalizationData = {}; for (let [k, v] of fd) personalizationData[k] = v;
            localStorage.setItem('personalizationData', JSON.stringify(personalizationData));
            closePersonalizationModal();
            const toast = document.createElement('div');
            toast.className = 'fixed bottom-6 right-6 bg-purple-600 text-white px-5 py-3 rounded-xl shadow-lg z-50 flex items-center gap-3 slide-up';
            toast.innerHTML = '<i class="fas fa-check-circle"></i><span>Dados salvos com sucesso!</span>';
            document.body.appendChild(toast);
            setTimeout(() => toast.remove(), 3000);
        }

        // -----------------------------------------------------
        // 6. EVENT LISTENERS
        // -----------------------------------------------------
        document.getElementById('mobileMenuBtn').onclick = toggleSidebar;
        document.getElementById('closeSidebarBtn').onclick = toggleSidebar;
        document.getElementById('overlay').onclick = toggleSidebar;
        document.getElementById('searchInput').oninput = (e) => renderList(e.target.value);
        document.getElementById('generatorForm').onsubmit = handleGenerate;

        // PWA Install
        if ('serviceWorker' in navigator) navigator.serviceWorker.register('./sw.js');
        let deferredPrompt;
        const installBtn = document.getElementById('installBtn');
        const fabInstall = document.getElementById('fabInstall');

        window.addEventListener('beforeinstallprompt', e => {
            e.preventDefault();
            deferredPrompt = e;
            installBtn.classList.remove('hidden');
            fabInstall.classList.remove('hidden');
        });

        installBtn.onclick = triggerInstall;

        // INIT
        window.addEventListener('load', () => {
            // Show main app (it is behind the overlay)
            document.getElementById('mainApp').classList.remove('hidden-screen');

            // Fade out intro
            setTimeout(() => {
                const overlay = document.getElementById('introOverlay');
                overlay.style.opacity = '0';
                setTimeout(() => overlay.style.visibility = 'hidden', 800);
            }, 2500);

            updateProviderIndicator();
            renderList();
        });
    </script>
</body>

</html>