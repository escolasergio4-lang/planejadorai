<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Educador IA - BNCC Pro</title>
    <meta name="theme-color" content="#2563eb">
    <link rel="manifest" href="manifest.json">
    <link rel="apple-touch-icon" href="https://cdn-icons-png.flaticon.com/512/3426/3426653.png">
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" rel="stylesheet">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
        
        /* Scrollbar */
        .scrollbar-thin::-webkit-scrollbar { width: 6px; }
        .scrollbar-thin::-webkit-scrollbar-track { background: transparent; }
        .scrollbar-thin::-webkit-scrollbar-thumb { background-color: rgba(37, 99, 235, 0.3); border-radius: 20px; }
        
        /* CORREÇÃO DO LAYOUT DO SIDEBAR */
        #sidebar {
            display: flex;
            flex-direction: column;
            height: 100vh; /* Ocupa altura total */
            max-height: 100vh;
            overflow: hidden; /* Evita scroll duplo */
        }
        
        /* O cabeçalho do sidebar não encolhe */
        #sidebar-header {
            flex-shrink: 0;
        }

        /* A lista cresce e rola */
        #toolList {
            flex-grow: 1;
            overflow-y: auto;
            min-height: 0; /* Importante para o Firefox */
        }

        /* O rodapé não encolhe */
        #sidebar-footer {
            flex-shrink: 0;
        }

        /* Utilitários */
        .hidden-screen { display: none !important; }
        .fade-in { animation: fadeIn 0.5s ease-in; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        
        /* Animações */
        .pencil-loader { display: inline-block; font-size: 40px; color: #2563eb; animation: writing 0.8s infinite alternate; transform-origin: bottom center; }
        @keyframes writing { 0% { transform: rotate(-15deg) translateY(0); } 100% { transform: rotate(15deg) translateY(-5px); } }
        
        .loader { border: 4px solid #f3f3f3; border-radius: 50%; border-top: 4px solid #3498db; width: 40px; height: 40px; animation: spin 1s linear infinite; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

        /* Estilo do conteúdo gerado */
        .markdown-body h1 { font-size: 1.5em; font-weight: bold; color: #1e40af; margin-bottom: 0.5em; }
        .markdown-body h2 { font-size: 1.3em; font-weight: bold; color: #3730a3; margin-top: 1em; margin-bottom: 0.5em; }
        .markdown-body ul, .markdown-body ol { margin-left: 1.5em; margin-bottom: 1em; }
        .markdown-body p { margin-bottom: 1em; line-height: 1.6; }
        .markdown-body strong { color: #1f2937; }
    </style>
</head>
<body class="bg-gray-50 h-screen overflow-hidden">

    <div id="loginScreen" class="absolute inset-0 z-50 bg-gradient-to-br from-blue-900 via-blue-700 to-indigo-800 flex flex-col items-center justify-center p-4">
        <div class="mb-8 p-6 bg-white/10 rounded-full backdrop-blur-sm shadow-2xl animate-bounce">
            <i class="fas fa-graduation-cap text-6xl text-white"></i>
        </div>
        <div class="bg-white rounded-2xl shadow-2xl w-full max-w-md overflow-hidden fade-in">
            <div class="p-8">
                <div class="text-center mb-8">
                    <h1 class="text-2xl font-bold text-gray-800">Área do Professor</h1>
                    <p class="text-gray-500 text-sm mt-1">Educador IA - BNCC Pro</p>
                </div>
                <form id="loginForm" class="space-y-6" onsubmit="handleLogin(event)" autocomplete="off">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Email</label>
                        <input type="email" id="loginEmail" name="app_login_email" required class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none" placeholder="appescola@email.com" autocomplete="username">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Senha</label>
                        <input type="password" id="loginPass" name="app_login_pass" required class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none" placeholder="••••••••" autocomplete="current-password">
                    </div>
                    <button type="submit" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 rounded-lg shadow-lg transform active:scale-95 transition-all">Entrar</button>
                </form>
                <div id="loginLoader" class="hidden flex flex-col items-center justify-center mt-6">
                    <div class="pencil-loader mb-2"><i class="fas fa-pencil-alt"></i></div>
                    <p class="text-blue-600 font-medium text-sm">Validando...</p>
                </div>
                <p id="loginError" class="hidden text-red-500 text-center text-sm mt-4 bg-red-50 p-2 rounded">Dados incorretos.</p>
            </div>
            <div class="bg-gray-50 p-4 text-center border-t border-gray-100">
                <button id="installAppBtn" class="text-sm text-blue-600 font-medium hover:text-blue-800 hidden"><i class="fas fa-download mr-1"></i> Instalar App</button>
            </div>
        </div>
    </div>

    <div id="mainApp" class="hidden-screen h-full flex overflow-hidden">
        
        <div class="md:hidden fixed top-0 w-full bg-gradient-to-r from-blue-700 to-indigo-700 text-white z-50 flex items-center justify-between px-4 py-3 shadow-lg flex-shrink-0" style="height: 60px;">
            <div class="flex items-center gap-3">
                <button onclick="returnToHome()" class="p-1 hover:bg-white/10 rounded-lg transition-colors">
                    <i class="fas fa-home text-lg"></i>
                </button>
                <h1 class="text-lg font-bold">Educador IA</h1>
            </div>
            <button id="mobileMenuBtn" class="p-2 hover:bg-white/10 rounded-lg transition-colors">
                <i class="fas fa-bars text-xl"></i>
            </button>
        </div>

        <aside id="sidebar" class="fixed inset-y-0 left-0 z-40 w-80 bg-white border-r border-gray-200 transform -translate-x-full md:translate-x-0 transition-transform duration-300 shadow-2xl md:shadow-none pt-[60px] md:pt-0">
            
            <div id="sidebar-header" class="p-6 bg-gradient-to-br from-blue-700 to-indigo-700 text-white">
                <div class="flex justify-between items-start mb-4">
                    <div class="flex items-center gap-3">
                        <button onclick="returnToHome()" class="p-2 hover:bg-white/10 rounded-lg transition-colors" title="Voltar ao início">
                            <i class="fas fa-home text-lg"></i>
                        </button>
                        <h1 class="text-2xl font-bold">Educador IA</h1>
                    </div>
                    <button id="closeSidebarBtn" class="md:hidden text-white/80 hover:text-white p-1">
                        <i class="fas fa-times text-xl"></i>
                    </button>
                </div>
                <p class="text-blue-100 text-sm mb-4">Ferramenta Offline-First.</p>
                
                <button id="installBtn" class="hidden w-full mb-4 px-4 py-2 bg-white/20 hover:bg-white/30 text-white rounded-lg text-sm font-semibold transition-colors flex items-center justify-center gap-2">
                    <i class="fas fa-download"></i> Instalar App
                </button>

                <div class="relative">
                    <i class="fas fa-search absolute left-3 top-1/2 -translate-y-1/2 text-blue-300"></i>
                    <input type="search" id="searchInput" name="search_tools_unique_id" autocomplete="off" class="w-full bg-white/10 border border-white/20 rounded-lg pl-9 pr-3 py-2 text-sm text-white placeholder-blue-200 focus:outline-none focus:bg-white/20" placeholder="Buscar gerador...">
                </div>
            </div>
            
            <nav id="toolList" class="scrollbar-thin p-2 space-y-1"></nav>
            
            <div id="sidebar-footer" class="p-4 border-t border-gray-200 bg-gray-50 space-y-2">
                <button onclick="showGuideModal()" class="w-full flex items-center justify-center gap-2 text-indigo-700 bg-indigo-50 hover:bg-indigo-100 px-3 py-2 rounded-lg text-sm font-semibold transition-colors mb-2">
                    <i class="fas fa-book-reader"></i> Guia Didático
                </button>

                <button onclick="showTutorialModal()" class="w-full flex items-center justify-center gap-2 text-blue-700 bg-blue-100 hover:bg-blue-200 px-3 py-2 rounded-lg text-sm font-semibold transition-colors">
                    <i class="fas fa-question-circle"></i> Ajuda / Chaves
                </button>
                <div class="text-center text-xs text-gray-500 pt-2 border-t border-gray-200">
                    <p>© 2026 Educador IA</p>
                    <p class="text-blue-600 font-semibold cursor-pointer hover:underline" onclick="showApiKeyModal()">
                        <i class="fas fa-plug mr-1"></i>Configurar IA
                    </p>
                    <button id="logoutBtn" onclick="logout()" class="text-red-500 mt-2 hover:underline text-xs cursor-pointer">Sair</button>
                </div>
            </div>
        </aside>

        <div id="overlay" class="fixed inset-0 bg-black/50 z-30 hidden md:hidden"></div>

        <main class="flex-1 flex flex-col h-full w-full md:ml-80 pt-[60px] md:pt-0 bg-gray-50">
            
            <div id="welcomeState" class="absolute inset-0 flex flex-col items-center justify-center text-center p-8 z-10 bg-gradient-to-br from-gray-50 to-blue-50 overflow-y-auto">
                <div class="w-32 h-32 bg-gradient-to-br from-blue-100 to-indigo-100 rounded-full flex items-center justify-center mb-8 shadow-lg shrink-0">
                    <i class="fas fa-graduation-cap text-6xl text-blue-600"></i>
                </div>
                <h2 class="text-3xl md:text-4xl font-bold text-gray-800 mb-4">Assistente Pedagógico BNCC</h2>
                <p class="text-gray-600 max-w-2xl mb-8 text-lg">Use a IA integrada ou gere prompts otimizados para copiar.</p>
                
                <div id="apiKeyWarning" class="hidden mb-6 p-4 bg-yellow-100 text-yellow-800 rounded-lg max-w-md text-sm text-left shadow-sm cursor-pointer hover:bg-yellow-200 transition" onclick="showTutorialModal()">
                    <p class="font-bold mb-1"><i class="fas fa-exclamation-triangle mr-1"></i> Configuração Necessária</p>
                    Clique aqui para aprender a criar sua Chave API gratuita.
                </div>

                <div class="flex flex-col sm:flex-row gap-4">
                    <button onclick="document.getElementById('mobileMenuBtn').click()" class="md:hidden px-6 py-3 bg-blue-600 text-white rounded-full font-semibold shadow-lg hover:bg-blue-700">
                        <i class="fas fa-bars mr-2"></i>Menu
                    </button>
                    <button onclick="showPersonalizationModal()" class="px-6 py-3 bg-indigo-600 text-white rounded-full font-semibold shadow-lg hover:bg-indigo-700">
                        <i class="fas fa-user-cog mr-2"></i>Meus Dados
                    </button>
                    <button onclick="showApiKeyModal()" class="px-6 py-3 bg-emerald-600 text-white rounded-full font-semibold shadow-lg hover:bg-emerald-700">
                        <i class="fas fa-plug mr-2"></i>Conectar IA
                    </button>
                </div>
            </div>

            <div id="generatorContainer" class="hidden w-full h-full flex flex-col bg-white">
                <div class="bg-gradient-to-r from-blue-600 to-indigo-600 text-white p-6 shadow-lg flex-shrink-0">
                    <div class="flex items-center justify-between flex-wrap gap-4">
                        <div class="flex items-center gap-4">
                            <i id="generatorIcon" class="fas fa-brain text-2xl"></i>
                            <div>
                                <h2 id="generatorTitle" class="text-2xl font-bold">Gerador</h2>
                                <p id="generatorDescription" class="text-blue-100 text-sm">Descrição</p>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="flex-1 overflow-y-auto p-6">
                    <form id="generatorForm" class="max-w-4xl mx-auto space-y-6"></form>
                </div>
                <div class="bg-gray-50 border-t p-6 flex-shrink-0">
                    <div class="max-w-4xl mx-auto flex flex-col sm:flex-row gap-4 justify-between items-center">
                        <div class="text-sm text-gray-600 hidden sm:block" id="providerIndicator">
                            <i class="fas fa-shield-alt text-blue-600 mr-2"></i>Modo Padrão
                        </div>
                        <div class="flex flex-wrap gap-2 w-full sm:w-auto justify-end">
                            <button type="button" onclick="resetForm()" class="px-4 py-2 text-gray-600 hover:text-gray-800 border border-gray-300 rounded-lg">
                                <i class="fas fa-undo mr-2"></i>Limpar
                            </button>
                            
                            <button type="button" onclick="handleGeneratePromptOnly()" class="px-4 py-2 bg-white text-blue-600 border border-blue-600 rounded-lg hover:bg-blue-50 font-semibold shadow-sm transition-transform active:scale-95">
                                <i class="fas fa-copy mr-2"></i>Copiar Prompt
                            </button>

                            <button type="submit" form="generatorForm" class="px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 font-semibold shadow-md transition-transform active:scale-95">
                                <i class="fas fa-magic mr-2"></i>Gerar com IA
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <div id="resultModal" class="fixed inset-0 bg-black/50 z-50 hidden flex items-center justify-center p-4">
        <div class="bg-white rounded-xl shadow-2xl max-w-4xl w-full max-h-[90vh] flex flex-col">
            <div class="bg-gradient-to-r from-blue-600 to-indigo-600 text-white p-4 rounded-t-xl flex items-center justify-between">
                <h3 class="text-lg font-bold">Resultado</h3>
                <button onclick="closeModal()" class="text-white/80 hover:text-white">
                    <i class="fas fa-times text-xl"></i>
                </button>
            </div>
            
            <div class="flex-1 overflow-y-auto p-6 relative">
                <div id="loadingState" class="hidden absolute inset-0 bg-white flex flex-col items-center justify-center z-10">
                    <div class="loader mb-4"></div>
                    <p class="text-gray-600 font-medium animate-pulse">A IA está pensando...</p>
                    <p class="text-xs text-gray-400 mt-2" id="loadingText">Consultando provedor...</p>
                </div>

                <div id="aiContent" class="markdown-body text-gray-800 whitespace-pre-wrap"></div>
            </div>

            <div class="p-6 border-t bg-gray-50 rounded-b-xl flex justify-end gap-3">
                <button onclick="copyContent()" class="px-4 py-2 bg-white border border-gray-300 rounded-lg hover:bg-gray-50">
                    <i class="fas fa-copy mr-2"></i>Copiar Texto
                </button>
                <button onclick="closeModal()" class="px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700">
                    Fechar
                </button>
            </div>
        </div>
    </div>

    <div id="masterPromptModal" class="fixed inset-0 bg-black/50 z-50 hidden flex items-center justify-center p-4">
        <div class="bg-white rounded-xl shadow-2xl max-w-4xl w-full max-h-[90vh] flex flex-col">
            <div class="bg-gradient-to-r from-indigo-600 to-blue-600 text-white p-6 rounded-t-xl flex items-center justify-between">
                <h3 class="text-xl font-bold"><i class="fas fa-brain mr-2"></i>Prompt Mestre</h3>
                <button onclick="closeMasterPrompt()" class="text-white/80 hover:text-white">
                    <i class="fas fa-times text-xl"></i>
                </button>
            </div>
            <div class="flex-1 overflow-y-auto p-6">
                <div class="bg-gray-50 rounded-lg p-4 mb-4">
                    <pre id="masterPromptText" class="text-sm text-gray-800 whitespace-pre-wrap"></pre>
                </div>
            </div>
        </div>
    </div>

    <div id="personalizationModal" class="fixed inset-0 bg-black/50 z-50 hidden flex items-center justify-center p-4">
        <div class="bg-white rounded-xl shadow-2xl max-w-2xl w-full max-h-[90vh] flex flex-col">
            <div class="bg-gradient-to-r from-purple-600 to-indigo-600 text-white p-6 rounded-t-xl flex items-center justify-between">
                <h3 class="text-xl font-bold"><i class="fas fa-user-cog mr-2"></i>Personalizar Dados</h3>
                <button onclick="closePersonalizationModal()" class="text-white/80 hover:text-white">
                    <i class="fas fa-times text-xl"></i>
                </button>
            </div>
            <div class="flex-1 overflow-y-auto p-6">
                <form id="personalizationForm" class="space-y-4">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Nome do(a) Professor(a)</label>
                            <input type="text" name="professorName" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Nome da Escola</label>
                            <input type="text" name="schoolName" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Ano Letivo</label>
                            <input type="text" name="schoolYear" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Unidade Didática</label>
                            <input type="text" name="didacticUnit" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500">
                        </div>
                    </div>
                </form>
            </div>
            <div class="p-6 border-t bg-gray-50 rounded-b-xl">
                <div class="flex justify-end gap-3">
                    <button onclick="closePersonalizationModal()" class="px-4 py-2 text-gray-600 hover:text-gray-800">Cancelar</button>
                    <button onclick="savePersonalization()" class="px-6 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 font-semibold">Salvar Dados</button>
                </div>
            </div>
        </div>
    </div>

    <div id="apiKeyModal" class="fixed inset-0 bg-black/50 z-50 hidden flex items-center justify-center p-4">
        <div class="bg-white rounded-xl shadow-2xl max-w-md w-full overflow-hidden">
            <div class="bg-emerald-600 text-white p-4 flex justify-between items-center">
                <h3 class="text-lg font-bold"><i class="fas fa-plug mr-2"></i>Configurar API</h3>
                <button onclick="document.getElementById('apiKeyModal').classList.add('hidden')" class="text-white hover:text-gray-200"><i class="fas fa-times"></i></button>
            </div>
            <div class="p-6 space-y-4">
                <div>
                    <label class="block text-sm font-bold text-gray-700 mb-1">Provedor</label>
                    <select id="providerSelect" class="w-full border rounded-lg p-2" onchange="toggleCustomFields()">
                        <option value="gemini">Google Gemini (Grátis)</option>
                        <option value="groq">Groq (Grátis/Rápido)</option>
                        <option value="openai">OpenAI (GPT-4)</option>
                        <option value="deepseek">DeepSeek</option>
                        <option value="anthropic">Claude (Oficial)</option>
                        <option value="openrouter">OpenRouter (Universal)</option>
                    </select>
                </div>
                <div>
                    <label class="block text-sm font-bold text-gray-700 mb-1">Chave API (Key)</label>
                    <input type="password" id="apiKeyInput" class="w-full border rounded-lg p-2" placeholder="Cole sua chave aqui...">
                </div>
                <div id="customFields" class="hidden">
                    <label class="block text-sm font-bold text-gray-700 mb-1">Modelo</label>
                    <input type="text" id="modelInput" class="w-full border rounded-lg p-2 text-sm">
                </div>
            </div>
            <div class="p-4 border-t flex justify-end gap-2">
                <button onclick="document.getElementById('apiKeyModal').classList.add('hidden')" class="px-4 py-2 text-gray-600">Cancelar</button>
                <button onclick="saveApiConfig()" class="px-4 py-2 bg-emerald-600 text-white rounded-lg">Salvar</button>
            </div>
        </div>
    </div>

    <div id="tutorialModal" class="fixed inset-0 bg-black/50 z-50 hidden flex items-center justify-center p-4">
            <div class="bg-white rounded-xl shadow-2xl max-w-3xl w-full max-h-[90vh] flex flex-col">
                <div class="bg-gradient-to-r from-cyan-600 to-blue-600 text-white p-6 rounded-t-xl flex justify-between">
                    <h3 class="text-xl font-bold">Como obter a Chave API</h3>
                    <button onclick="closeTutorialModal()" class="text-white hover:text-gray-200">
                        <i class="fas fa-times text-xl"></i>
                    </button>
                </div>
                
                <div class="flex-1 overflow-y-auto p-6 space-y-6">
                    <div class="bg-blue-50 p-4 rounded border border-blue-200">
                        <p class="text-blue-800 text-sm"><strong>O que é isso?</strong> É uma "senha" gratuita que conecta o app à inteligência do Google ou outras IAs.</p>
                    </div>
                    
                    <div>
                        <h4 class="font-bold text-gray-800">1. Google Gemini (Recomendado)</h4>
                        <ol class="list-decimal ml-5 text-sm text-gray-600 space-y-1">
                            <li>Acesse <a href="https://aistudio.google.com/app/apikey" target="_blank" class="text-blue-600 underline">Google AI Studio</a>.</li>
                            <li>Clique em <strong>Create API Key</strong>.</li>
                            <li>Copie o código gerado e cole no app.</li>
                        </ol>
                    </div>
                    
                    <div>
                        <h4 class="font-bold text-gray-800">2. Groq (Muito Rápido)</h4>
                        <ol class="list-decimal ml-5 text-sm text-gray-600 space-y-1">
                            <li>Acesse <a href="https://console.groq.com/keys" target="_blank" class="text-blue-600 underline">Groq Console</a>.</li>
                            <li>Crie uma chave e cole no app.</li>
                        </ol>
                        
                        <div class="mt-4 pt-4 border-t border-gray-100 text-center">
                            <p class="text-sm text-gray-600">
                                Se preferir gerar apenas o Prompt, leve para o 
                                <a href="https://claude.ai" target="_blank" class="text-blue-600 font-bold hover:underline">claude.ai</a> 
                                (testado)
                            </p>
                        </div>
                    </div>
                </div>
                
                <div class="p-4 border-t flex justify-end">
                    <button onclick="closeTutorialModal()" class="px-6 py-2 bg-cyan-600 text-white rounded-lg hover:bg-cyan-700 font-medium">Entendi</button>
                </div>
            </div>
        </div>

    <div id="guideModal" class="fixed inset-0 bg-black/50 z-50 hidden flex items-center justify-center p-4">
        <div class="bg-white rounded-xl shadow-2xl max-w-4xl w-full max-h-[90vh] flex flex-col">
            <div class="bg-gradient-to-r from-indigo-600 to-purple-600 text-white p-6 rounded-t-xl flex justify-between items-center">
                <div>
                    <h3 class="text-xl font-bold"><i class="fas fa-book-reader mr-2"></i>Guia Didático dos Geradores</h3>
                    <p class="text-indigo-100 text-sm mt-1">Entenda o funcionamento pedagógico de cada ferramenta.</p>
                </div>
                <button onclick="closeGuideModal()" class="text-white hover:text-gray-200">
                    <i class="fas fa-times text-xl"></i>
                </button>
            </div>
            
            <div class="flex-1 overflow-y-auto p-6 space-y-6 bg-gray-50">
                
                <div class="bg-white p-5 rounded-lg shadow-sm border-l-4 border-yellow-500">
                    <div class="flex items-start gap-4">
                        <div class="bg-yellow-100 p-3 rounded-full text-yellow-600"><i class="fas fa-star text-xl"></i></div>
                        <div>
                            <h4 class="text-lg font-bold text-gray-800 mb-2">Avaliação Formativa Mestre</h4>
                            <p class="text-sm text-gray-600 mb-3"><strong>O que é:</strong> Um construtor de provas e testes de alta complexidade pedagógica.</p>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-sm">
                                <div class="bg-gray-50 p-3 rounded">
                                    <strong class="text-gray-700 block mb-1">Para que serve?</strong>
                                    Para criar avaliações que vão além da memorização. Ela utiliza a Taxonomia de Bloom para garantir que o aluno analise, compreenda e aplique o conhecimento.
                                </div>
                                <div class="bg-gray-50 p-3 rounded">
                                    <strong class="text-gray-700 block mb-1">Como usar:</strong>
                                    No campo "Distribuição Bloom", defina quantos níveis você quer (ex: "2 Lembrar, 3 Analisar"). Detalhe bem o contexto da turma para que a IA calibre a linguagem.
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="bg-white p-5 rounded-lg shadow-sm border-l-4 border-emerald-500">
                    <div class="flex items-start gap-4">
                        <div class="bg-emerald-100 p-3 rounded-full text-emerald-600"><i class="fas fa-user-md text-xl"></i></div>
                        <div>
                            <h4 class="text-lg font-bold text-gray-800 mb-2">Avaliação Diagnóstica (Sondagem)</h4>
                            <p class="text-sm text-gray-600 mb-3"><strong>O que é:</strong> Uma ferramenta para descobrir o que o aluno sabe (ou não sabe) antes de começar um conteúdo novo.</p>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-sm">
                                <div class="bg-gray-50 p-3 rounded">
                                    <strong class="text-gray-700 block mb-1">Para que serve?</strong>
                                    Para identificar lacunas de aprendizagem de anos anteriores. Diferente da prova comum, o foco aqui é encontrar pré-requisitos não consolidados.
                                </div>
                                <div class="bg-gray-50 p-3 rounded">
                                    <strong class="text-gray-700 block mb-1">Como usar:</strong>
                                    O campo mais importante é "Séries Anteriores". Se seu aluno está no 8º ano, peça para sondar conteúdos do 6º e 7º ano. Evite pedir questões de "criação" aqui; foque em compreensão básica.
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="bg-white p-5 rounded-lg shadow-sm border-l-4 border-blue-500">
                    <div class="flex items-start gap-4">
                        <div class="bg-blue-100 p-3 rounded-full text-blue-600"><i class="fas fa-chalkboard-teacher text-xl"></i></div>
                        <div>
                            <h4 class="text-lg font-bold text-gray-800 mb-2">Plano de Aula</h4>
                            <p class="text-sm text-gray-600 mb-3"><strong>O que é:</strong> O roteiro detalhado para um dia letivo ou um encontro específico.</p>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-sm">
                                <div class="bg-gray-50 p-3 rounded">
                                    <strong class="text-gray-700 block mb-1">Para que serve?</strong>
                                    Organizar o tempo, definir a metodologia e garantir que a aula tenha início, meio e fim alinhados à BNCC.
                                </div>
                                <div class="bg-gray-50 p-3 rounded">
                                    <strong class="text-gray-700 block mb-1">Como usar:</strong>
                                    Seja específico na duração (ex: 50 min). No campo metodologia, escolha se quer uma aula expositiva ou ativa (ex: rotação por estações).
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="bg-white p-5 rounded-lg shadow-sm border-l-4 border-purple-500">
                    <div class="flex items-start gap-4">
                        <div class="bg-purple-100 p-3 rounded-full text-purple-600"><i class="fas fa-list-ol text-xl"></i></div>
                        <div>
                            <h4 class="text-lg font-bold text-gray-800 mb-2">Sequência Didática</h4>
                            <p class="text-sm text-gray-600 mb-3"><strong>O que é:</strong> Um conjunto de aulas encadeadas sobre o mesmo tema.</p>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-sm">
                                <div class="bg-gray-50 p-3 rounded">
                                    <strong class="text-gray-700 block mb-1">Para que serve?</strong>
                                    Para aprofundar um assunto que não cabe em uma só aula. Permite evolução gradual da dificuldade.
                                </div>
                                <div class="bg-gray-50 p-3 rounded">
                                    <strong class="text-gray-700 block mb-1">Como usar:</strong>
                                    Defina o número de aulas (ex: 5 aulas). A IA irá dividir o conteúdo: introdução nas primeiras, desenvolvimento no meio e avaliação/conclusão na última.
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="bg-white p-5 rounded-lg shadow-sm border-l-4 border-orange-500">
                    <div class="flex items-start gap-4">
                        <div class="bg-orange-100 p-3 rounded-full text-orange-600"><i class="fas fa-project-diagram text-xl"></i></div>
                        <div>
                            <h4 class="text-lg font-bold text-gray-800 mb-2">Projeto Didático</h4>
                            <p class="text-sm text-gray-600 mb-3"><strong>O que é:</strong> Um trabalho de longo prazo, geralmente interdisciplinar, focado em resolver um problema real.</p>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-sm">
                                <div class="bg-gray-50 p-3 rounded">
                                    <strong class="text-gray-700 block mb-1">Para que serve?</strong>
                                    Engajar alunos na construção de um "Produto Final" (ex: uma feira, um livro, um vídeo). Ótimo para feiras de ciências.
                                </div>
                                <div class="bg-gray-50 p-3 rounded">
                                    <strong class="text-gray-700 block mb-1">Como usar:</strong>
                                    O campo "Problema" é vital. Defina uma questão instigante (ex: "Como reduzir o lixo na escola?").
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                 <div class="bg-white p-5 rounded-lg shadow-sm border-l-4 border-gray-400">
                    <h4 class="text-lg font-bold text-gray-800 mb-4">Outras Ferramentas Rápidas</h4>
                    <div class="grid grid-cols-1 sm:grid-cols-2 gap-4 text-sm">
                        <div class="bg-gray-50 p-3 rounded">
                            <strong class="text-blue-700"><i class="fas fa-book mr-1"></i> Plano de Curso:</strong>
                            Planejamento macro (anual ou semestral). Divide o ano em 3 grandes unidades.
                        </div>
                        <div class="bg-gray-50 p-3 rounded">
                            <strong class="text-blue-700"><i class="fas fa-layer-group mr-1"></i> Plano de Unidade:</strong>
                            Planejamento médio. Foca em um capítulo ou tema específico do bimestre.
                        </div>
                        <div class="bg-gray-50 p-3 rounded">
                            <strong class="text-blue-700"><i class="fas fa-tasks mr-1"></i> Atividade:</strong>
                            Gera um exercício único e prático para sala de aula ou casa.
                        </div>
                        <div class="bg-gray-50 p-3 rounded">
                            <strong class="text-blue-700"><i class="fas fa-clipboard-check mr-1"></i> Avaliação Simples:</strong>
                            Cria provas tradicionais, rubricas ou roteiros de observação.
                        </div>
                        <div class="bg-gray-50 p-3 rounded">
                            <strong class="text-blue-700"><i class="fas fa-question-circle mr-1"></i> Quiz:</strong>
                            Perguntas rápidas de múltipla escolha para revisão ou gamificação.
                        </div>
                        <div class="bg-gray-50 p-3 rounded">
                            <strong class="text-blue-700"><i class="fas fa-gamepad mr-1"></i> Jogo Educativo:</strong>
                            Cria regras e mecânicas para transformar o conteúdo em brincadeira (tabuleiro, cartas, etc).
                        </div>
                         <div class="bg-gray-50 p-3 rounded">
                            <strong class="text-blue-700"><i class="fas fa-globe-americas mr-1"></i> Temas Transversais:</strong>
                            Insere temas sociais (meio ambiente, ética) dentro da sua disciplina padrão.
                        </div>
                    </div>
                </div>

            </div>
            
            <div class="p-4 border-t bg-gray-50 flex justify-end">
                <button onclick="closeGuideModal()" class="px-6 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 font-medium">Entendi, obrigado!</button>
            </div>
        </div>
    </div>

    <script>
        // -----------------------------------------------------
        // 1. DADOS & PROMPT MESTRE
        // -----------------------------------------------------
        const MASTER_PROMPT = `Você é um especialista em educação e BNCC (Base Nacional Comum Curricular). Sua função é criar conteúdos educacionais de alta qualidade que estejam perfeitamente alinhados com as competências e habilidades da BNCC.

DIRETRIZES OBRIGATÓRIAS:
1. ALINHAMENTO BNCC: Sempre referencie as competências gerais e específicas da BNCC e códigos de habilidades.
2. QUALIDADE PEDAGÓGICA: Use metodologias ativas e diversificadas.
3. INCLUSÃO E DIVERSIDADE: Considere a diversidade cultural e acessibilidade.
4. CONTEXTUALIZAÇÃO: Conecte com a realidade dos estudantes.
5. ESTRUTURA CLARA: Objetivos de aprendizagem, sequência didática e avaliação.

Sempre que criar qualquer conteúdo educacional, certifique-se de que está contribuindo para o desenvolvimento das 10 competências gerais da BNCC.`;

        const generators = [
            {
                id: 'plano-curso',
                icon: 'fa-book',
                title: 'Plano de Curso',
                description: 'Planejamento anual ou semestral (3 Unidades)',
                fields: [
                    { type: 'select', name: 'etapa', label: 'Etapa de Ensino', required: true, options: ['Educação Infantil', 'Ensino Fundamental I', 'Ensino Fundamental II', 'Ensino Médio'] },
                    { type: 'text', name: 'serie', label: 'Série/Ano', required: true, placeholder: 'Ex: 9º ano' },
                    { type: 'select', name: 'area', label: 'Área do Conhecimento', required: true, options: ['Linguagens', 'Matemática', 'Ciências da Natureza', 'Ciências Humanas', 'Ensino Religioso'] },
                    { type: 'text', name: 'disciplina', label: 'Disciplina', required: true, placeholder: 'Ex: História, Literatura' },
                    { type: 'select', name: 'periodo', label: 'Período', required: true, options: ['Anual', 'Semestral', 'Bimestral', 'Trimestral'] },
                    { type: 'textarea', name: 'ementa', label: 'Ementa/Foco Principal', placeholder: 'Resumo do que será abordado no curso' },
                    { type: 'textarea', name: 'metodologia_geral', label: 'Metodologia Geral', placeholder: 'Ex: Ensino Híbrido, Pedagogia de Projetos' }
                ],
                prompt: (data) => `${MASTER_PROMPT}\nCrie um Plano de Curso detalhado:\nEtapa: ${data.etapa}\nSérie: ${data.serie}\nÁrea: ${data.area}\nDisciplina: ${data.disciplina}\nPeriodicidade: ${data.periodo}\nEmenta: ${data.ementa}\nMetodologia: ${data.metodologia_geral}\n\nIMPORTANTE: A Organização Curricular deve ser DIVIDIDA EM EXATAMENTE 3 UNIDADES, independentemente da duração.`
            },
            {
                id: 'plano-unidade',
                icon: 'fa-layer-group',
                title: 'Plano de Unidade',
                description: 'Planeje uma unidade temática específica',
                fields: [
                    { type: 'select', name: 'etapa', label: 'Etapa', required: true, options: ['Ed. Infantil', 'Fund. I', 'Fund. II', 'Médio'] },
                    { type: 'text', name: 'serie', label: 'Série', required: true },
                    { type: 'text', name: 'disciplina', label: 'Disciplina', required: true },
                    { type: 'text', name: 'titulo_unidade', label: 'Título da Unidade', required: true },
                    { type: 'number', name: 'num_aulas', label: 'Nº Aulas', placeholder: '10' },
                    { type: 'textarea', name: 'objetivos_unidade', label: 'Objetivos', required: true },
                    { type: 'textarea', name: 'estrategias', label: 'Estratégias' }
                ],
                prompt: (data) => `${MASTER_PROMPT}\nDesenvolva um Plano de Unidade:\nSérie: ${data.serie}\nDisciplina: ${data.disciplina}\nTítulo: ${data.titulo_unidade}\nAulas: ${data.num_aulas}\nObjetivos: ${data.objetivos_unidade}\nEstratégias: ${data.estrategias}\n\nEstrutura: Contextualização, Habilidades BNCC, Cronograma e Avaliação.`
            },
            {
                id: 'plano-aula',
                icon: 'fa-chalkboard-teacher',
                title: 'Plano de Aula',
                description: 'Crie planos de aula detalhados alinhados à BNCC',
                fields: [
                    { type: 'select', name: 'etapa', label: 'Etapa de Ensino', required: true, options: ['Educação Infantil', 'Ensino Fundamental I', 'Ensino Fundamental II', 'Ensino Médio'] },
                    { type: 'text', name: 'serie', label: 'Série/Ano', required: true, placeholder: 'Ex: 5º ano, 1ª série' },
                    { type: 'select', name: 'area', label: 'Área do Conhecimento', required: true, options: ['Linguagens', 'Matemática', 'Ciências da Natureza', 'Ciências Humanas', 'Ensino Religioso'] },
                    { type: 'text', name: 'disciplina', label: 'Disciplina', required: true, placeholder: 'Ex: Língua Portuguesa, História' },
                    { type: 'text', name: 'tema', label: 'Tema da Aula', required: true, placeholder: 'Ex: Sistema Solar, Frações' },
                    { type: 'number', name: 'duracao', label: 'Duração (minutos)', required: true, placeholder: '50' },
                    { type: 'textarea', name: 'objetivos', label: 'Objetivos Específicos', placeholder: 'Descreva os objetivos de aprendizagem' },
                    { type: 'textarea', name: 'recursos', label: 'Recursos Disponíveis', placeholder: 'Materiais, tecnologias, espaços' },
                    { type: 'select', name: 'metodologia', label: 'Metodologia Principal', options: ['Aula Expositiva', 'Aprendizagem Baseada em Problemas', 'Sala de Aula Invertida', 'Gamificação', 'Projeto', 'Estudo de Caso'] }
                ],
                prompt: (data) => `${MASTER_PROMPT}\nCrie um plano de aula completo:\nEtapa: ${data.etapa}\nSérie: ${data.serie}\nÁrea: ${data.area}\nDisciplina: ${data.disciplina}\nTema: ${data.tema}\nDuração: ${data.duracao} min\nMetodologia: ${data.metodologia}\nObjetivos: ${data.objetivos}\nRecursos: ${data.recursos}\n\nEstrutura: Identificação, Habilidades BNCC, Sequência Didática detalhada, Avaliação e Referências.`
            },
            {
                id: 'atividade',
                icon: 'fa-tasks',
                title: 'Atividade Pedagógica',
                description: 'Desenvolva atividades práticas e envolventes',
                fields: [
                    { type: 'select', name: 'etapa', label: 'Etapa de Ensino', required: true, options: ['Educação Infantil', 'Ensino Fundamental I', 'Ensino Fundamental II', 'Ensino Médio'] },
                    { type: 'text', name: 'serie', label: 'Série/Ano', required: true },
                    { type: 'select', name: 'area', label: 'Área do Conhecimento', required: true, options: ['Linguagens', 'Matemática', 'Ciências da Natureza', 'Ciências Humanas', 'Ensino Religioso'] },
                    { type: 'text', name: 'tema', label: 'Tema/Conteúdo', required: true },
                    { type: 'select', name: 'tipo', label: 'Tipo de Atividade', options: ['Individual', 'Dupla', 'Grupo', 'Coletiva'] },
                    { type: 'number', name: 'tempo', label: 'Tempo Estimado (min)', placeholder: '30' },
                    { type: 'textarea', name: 'objetivo', label: 'Objetivo da Atividade', placeholder: 'O que os alunos devem aprender/desenvolver' },
                    { type: 'select', name: 'dificuldade', label: 'Nível de Dificuldade', options: ['Básico', 'Intermediário', 'Avançado'] }
                ],
                prompt: (data) => `${MASTER_PROMPT}\nDesenvolva uma atividade pedagógica:\nEtapa: ${data.etapa}\nSérie: ${data.serie}\nÁrea: ${data.area}\nTema: ${data.tema}\nTipo: ${data.tipo}\nTempo: ${data.tempo} min\nNível: ${data.dificuldade}\nObjetivo: ${data.objetivo}\n\nEstrutura: Identificação, Habilidades BNCC, Instruções passo a passo, Critérios de Avaliação e Adaptações.`
            },
            {
                id: 'avaliacao',
                icon: 'fa-clipboard-check',
                title: 'Avaliação',
                description: 'Crie instrumentos de avaliação alinhados à BNCC',
                fields: [
                    { type: 'select', name: 'etapa', label: 'Etapa de Ensino', required: true, options: ['Educação Infantil', 'Ensino Fundamental I', 'Ensino Fundamental II', 'Ensino Médio'] },
                    { type: 'text', name: 'serie', label: 'Série/Ano', required: true },
                    { type: 'select', name: 'area', label: 'Área do Conhecimento', required: true, options: ['Linguagens', 'Matemática', 'Ciências da Natureza', 'Ciências Humanas', 'Ensino Religioso'] },
                    { type: 'text', name: 'conteudo', label: 'Conteúdo Avaliado', required: true },
                    { type: 'select', name: 'tipo', label: 'Tipo de Avaliação', options: ['Diagnóstica', 'Formativa', 'Somativa', 'Autoavaliação', 'Avaliação por Pares'] },
                    { type: 'select', name: 'formato', label: 'Formato', options: ['Prova Escrita', 'Prova Oral', 'Projeto', 'Portfólio', 'Apresentação', 'Relatório', 'Mapa Mental'] },
                    { type: 'number', name: 'questoes', label: 'Número de Questões', placeholder: '10' },
                    { type: 'textarea', name: 'criterios', label: 'Critérios Específicos', placeholder: 'Aspectos importantes a serem avaliados' }
                ],
                prompt: (data) => `${MASTER_PROMPT}\nDesenvolva um instrumento de avaliação:\nEtapa: ${data.etapa}\nSérie: ${data.serie}\nÁrea: ${data.area}\nConteúdo: ${data.conteudo}\nTipo: ${data.tipo}\nFormato: ${data.formato}\nQuestões: ${data.questoes}\nCritérios: ${data.criterios}\n\nEstrutura: Habilidades BNCC, Questões/Atividades contextualizadas, Critérios de Correção e Feedback.`
            },
            {
                id: 'projeto',
                icon: 'fa-project-diagram',
                title: 'Projeto Didático',
                description: 'Desenvolva projetos interdisciplinares',
                fields: [
                    { type: 'select', name: 'etapa', label: 'Etapa de Ensino', required: true, options: ['Educação Infantil', 'Ensino Fundamental I', 'Ensino Fundamental II', 'Ensino Médio'] },
                    { type: 'text', name: 'serie', label: 'Série/Ano', required: true },
                    { type: 'text', name: 'tema', label: 'Tema do Projeto', required: true },
                    { type: 'textarea', name: 'areas', label: 'Áreas Envolvidas', placeholder: 'Ex: Português, História, Geografia' },
                    { type: 'select', name: 'duracao', label: 'Duração', options: ['1 semana', '2 semanas', '1 mês', '1 bimestre', '1 semestre'] },
                    { type: 'textarea', name: 'problema', label: 'Problema/Questão Norteadora', placeholder: 'Qual problema o projeto vai resolver?' },
                    { type: 'textarea', name: 'produto', label: 'Produto Final', placeholder: 'O que será produzido/apresentado' },
                    { type: 'select', name: 'metodologia', label: 'Metodologia', options: ['Aprendizagem Baseada em Projetos', 'Design Thinking', 'Metodologia Científica', 'STEAM'] }
                ],
                prompt: (data) => `${MASTER_PROMPT}\nDesenvolva um projeto didático interdisciplinar:\nEtapa: ${data.etapa}\nSérie: ${data.serie}\nTema: ${data.tema}\nÁreas: ${data.areas}\nDuração: ${data.duracao}\nProblema: ${data.problema}\nProduto: ${data.produto}\nMetodologia: ${data.metodologia}\n\nEstrutura: Justificativa, Competências BNCC, Cronograma, Recursos, Produto Final e Avaliação.`
            },
            {
                id: 'sequencia',
                icon: 'fa-list-ol',
                title: 'Sequência Didática',
                description: 'Planeje sequências de aulas articuladas',
                fields: [
                    { type: 'select', name: 'etapa', label: 'Etapa de Ensino', required: true, options: ['Educação Infantil', 'Ensino Fundamental I', 'Ensino Fundamental II', 'Ensino Médio'] },
                    { type: 'text', name: 'serie', label: 'Série/Ano', required: true },
                    { type: 'select', name: 'area', label: 'Área do Conhecimento', required: true, options: ['Linguagens', 'Matemática', 'Ciências da Natureza', 'Ciências Humanas', 'Ensino Religioso'] },
                    { type: 'text', name: 'tema', label: 'Tema Central', required: true },
                    { type: 'number', name: 'aulas', label: 'Número de Aulas', required: true, placeholder: '5' },
                    { type: 'number', name: 'duracao', label: 'Duração de cada aula (min)', placeholder: '50' },
                    { type: 'textarea', name: 'objetivo', label: 'Objetivo Geral da Sequência', required: true },
                    { type: 'textarea', name: 'conhecimentos', label: 'Conhecimentos Prévios', placeholder: 'O que os alunos já sabem sobre o tema' }
                ],
                prompt: (data) => `${MASTER_PROMPT}\nDesenvolva uma sequência didática:\nEtapa: ${data.etapa}\nSérie: ${data.serie}\nÁrea: ${data.area}\nTema: ${data.tema}\nAulas: ${data.aulas}\nDuração: ${data.duracao} min\nObjetivo: ${data.objetivo}\nConhecimentos prévios: ${data.conhecimentos}\n\nEstrutura: Habilidades BNCC, Desenvolvimento detalhado aula a aula, Avaliação Processual e Referências.`
            },
            {
                id: 'quiz',
                icon: 'fa-question-circle',
                title: 'Quiz Educativo',
                description: 'Crie quizzes interativos para fixação',
                fields: [
                    { type: 'select', name: 'etapa', label: 'Etapa de Ensino', required: true, options: ['Educação Infantil', 'Ensino Fundamental I', 'Ensino Fundamental II', 'Ensino Médio'] },
                    { type: 'text', name: 'serie', label: 'Série/Ano', required: true },
                    { type: 'select', name: 'area', label: 'Área do Conhecimento', required: true, options: ['Linguagens', 'Matemática', 'Ciências da Natureza', 'Ciências Humanas', 'Ensino Religioso'] },
                    { type: 'text', name: 'tema', label: 'Tema/Conteúdo', required: true },
                    { type: 'number', name: 'questoes', label: 'Número de Questões', required: true, placeholder: '10' },
                    { type: 'select', name: 'dificuldade', label: 'Nível de Dificuldade', options: ['Fácil', 'Médio', 'Difícil', 'Misto'] },
                    { type: 'select', name: 'tipo', label: 'Tipo de Questões', options: ['Múltipla Escolha', 'Verdadeiro/Falso', 'Completar', 'Misto'] },
                    { type: 'textarea', name: 'objetivo', label: 'Objetivo do Quiz', placeholder: 'Revisar, fixar, diagnosticar...' }
                ],
                prompt: (data) => `${MASTER_PROMPT}\nCrie um quiz educativo:\nEtapa: ${data.etapa}\nSérie: ${data.serie}\nÁrea: ${data.area}\nTema: ${data.tema}\nQuestões: ${data.questoes}\nDificuldade: ${data.dificuldade}\nTipo: ${data.tipo}\nObjetivo: ${data.objetivo}\n\nEstrutura: Habilidades BNCC, Questões numeradas com gabarito e explicação.`
            },
            {
                id: 'jogo',
                icon: 'fa-gamepad',
                title: 'Jogo Educativo',
                description: 'Desenvolva jogos para aprendizagem lúdica',
                fields: [
                    { type: 'select', name: 'etapa', label: 'Etapa de Ensino', required: true, options: ['Educação Infantil', 'Ensino Fundamental I', 'Ensino Fundamental II', 'Ensino Médio'] },
                    { type: 'text', name: 'serie', label: 'Série/Ano', required: true },
                    { type: 'select', name: 'area', label: 'Área do Conhecimento', required: true, options: ['Linguagens', 'Matemática', 'Ciências da Natureza', 'Ciências Humanas', 'Ensino Religioso'] },
                    { type: 'text', name: 'tema', label: 'Tema/Conteúdo', required: true },
                    { type: 'select', name: 'tipo', label: 'Tipo de Jogo', options: ['Tabuleiro', 'Cartas', 'Digital', 'Movimento', 'Quebra-cabeça', 'RPG Educativo'] },
                    { type: 'number', name: 'jogadores', label: 'Número de Jogadores', placeholder: '4' },
                    { type: 'number', name: 'tempo', label: 'Tempo de Jogo (min)', placeholder: '30' },
                    { type: 'textarea', name: 'objetivo', label: 'Objetivo Pedagógico', required: true }
                ],
                prompt: (data) => `${MASTER_PROMPT}\nDesenvolva um jogo educativo:\nEtapa: ${data.etapa}\nSérie: ${data.serie}\nÁrea: ${data.area}\nTema: ${data.tema}\nTipo: ${data.tipo}\nJogadores: ${data.jogadores}\nTempo: ${data.tempo} min\nObjetivo: ${data.objetivo}\n\nEstrutura: Regras, Materiais, Mecânica do Jogo, Variações e Dicas para o Professor.`
            },
            {
                id: 'temas-transversais',
                icon: 'fa-globe-americas',
                title: 'Temas Contemporâneos Transversais',
                description: 'Desenvolva atividades com temas transversais da BNCC',
                fields: [
                    { type: 'select', name: 'tipo_conteudo', label: 'Tipo de Conteúdo', required: true, options: ['Atividade', 'Plano de Aula', 'Sequência Didática', 'Projeto Didático'] },
                    { type: 'select', name: 'etapa', label: 'Etapa de Ensino', required: true, options: ['Educação Infantil', 'Ensino Fundamental I', 'Ensino Fundamental II', 'Ensino Médio'] },
                    { type: 'text', name: 'serie', label: 'Série/Ano', required: true },
                    { type: 'select', name: 'tema', label: 'Tema Transversal', required: true, options: ['Direitos Humanos', 'Educação Ambiental', 'Educação Alimentar', 'Educação Financeira', 'Educação Fiscal', 'Trabalho', 'Ciência e Tecnologia', 'Diversidade Cultural', 'Educação para o Trânsito', 'Saúde', 'Vida Familiar e Social', 'Educação para o Consumo', 'Processo de Envelhecimento', 'Respeito e Valorização do Idoso', 'Preservação do Meio Ambiente'] },
                    { type: 'select', name: 'area', label: 'Área Principal', required: true, options: ['Linguagens', 'Matemática', 'Ciências da Natureza', 'Ciências Humanas', 'Ensino Religioso'] },
                    { type: 'textarea', name: 'contexto', label: 'Contexto Local/Regional', placeholder: 'Descreva aspectos da realidade local que podem ser explorados' },
                    { type: 'select', name: 'metodologia', label: 'Metodologia', options: ['Projeto', 'Debate', 'Pesquisa', 'Estudo de Caso', 'Simulação', 'Campanha', 'Feira de Conhecimentos'] },
                    { type: 'number', name: 'duracao', label: 'Duração (aulas)', placeholder: '4' },
                    { type: 'textarea', name: 'objetivo', label: 'Objetivo Específico', placeholder: 'O que pretende desenvolver com este tema transversal' }
                ],
                prompt: (data) => `${MASTER_PROMPT}\nDesenvolva um(a) ${data.tipo_conteudo} sobre Tema Transversal:\nTema: ${data.tema}\nEtapa: ${data.etapa}\nSérie: ${data.serie}\nÁrea: ${data.area}\nContexto: ${data.contexto}\nMetodologia: ${data.metodologia}\nDuração: ${data.duracao} aulas\nObjetivo: ${data.objetivo}\n\nImportante: Trabalhe de forma integrada, promovendo reflexão crítica e cidadania.`
            },
            {
                id: 'av-formativa-mestre',
                icon: 'fa-star',
                title: 'Avaliação Formativa Mestre',
                description: 'Gera avaliações avançadas baseadas na Taxonomia de Bloom',
                fields: [
                    { type: 'text', name: 'nivel', label: 'Nível de Ensino', required: true, placeholder: 'Ex: Ensino Fundamental II (9º ano)' },
                    { type: 'text', name: 'area', label: 'Área/Disciplina', required: true, placeholder: 'Ex: História / Geografia' },
                    { type: 'text', name: 'unidade', label: 'Unidade Temática', required: true, placeholder: 'Ex: A Era Vargas' },
                    { type: 'textarea', name: 'objetivos', label: 'Objetivos de Aprendizagem (Habilidades)', required: true },
                    { type: 'textarea', name: 'contexto', label: 'Contexto Educacional', placeholder: 'Ex: Escola Rural, turma heterogênea...' },
                    { type: 'number', name: 'quantidade', label: 'Quantidade de Questões', required: true, placeholder: '5' },
                    { type: 'text', name: 'tipos', label: 'Tipos de Questões', placeholder: 'Ex: 2 Múltipla Escolha, 1 Estudo de Caso' },
                    { type: 'text', name: 'bloom', label: 'Distribuição Bloom', placeholder: 'Ex: 1 Lembrar, 2 Analisar, 2 Criar' },
                    { type: 'text', name: 'dificuldade', label: 'Níveis de Dificuldade', placeholder: 'Ex: 2 Básicas, 2 Intermediárias, 1 Avançada' },
                    { type: 'text', name: 'idioma', label: 'Idioma', placeholder: 'Português Brasileiro', required: true }
                ],
                prompt: (data) => `Você é um ESPECIALISTA EM AVALIAÇÃO EDUCACIONAL, DIDÁTICA, CURRÍCULO E CIÊNCIAS DA APRENDIZAGEM, com domínio da Taxonomia de Bloom (revisada), avaliação formativa e integridade acadêmica.

OBJETIVO:
Criar uma AVALIAÇÃO FORMATIVA AVANÇADA, pedagógica e cientificamente fundamentada, alinhada à unidade acadêmica, ao conteúdo curricular e aos objetivos de aprendizagem informados abaixo.

ENTRADAS DO USUÁRIO (CONTEXTO DA AVALIAÇÃO):
1. Nível de ensino: ${data.nivel}
2. Área do conhecimento / disciplina: ${data.area}
3. Unidade temática / conteúdo específico: ${data.unidade}
4. Objetivos de aprendizagem: ${data.objetivos}
5. Contexto educacional: ${data.contexto}
6. Quantidade total de questões: ${data.quantidade}
7. Tipos de questões desejados: ${data.tipos}
8. Distribuição Taxonomia de Bloom: ${data.bloom}
9. Níveis de dificuldade: ${data.dificuldade}
10. Idioma da avaliação: ${data.idioma}

DIRETRIZES OBRIGATÓRIAS:
- Todas as questões DEVEM ser de natureza FORMATIVA (diagnóstica ou reguladora da aprendizagem).
- As perguntas devem avaliar PROCESSOS COGNITIVOS, não apenas memorização.
- Cada questão deve indicar explicitamente:
  a) Nível da Taxonomia de Bloom
  b) Nível de dificuldade
  c) Habilidade cognitiva avaliada
- As questões devem variar em complexidade e abordagem.
- Utilizar linguagem adequada ao nível de ensino informado.
- Contextualizar sempre que possível (situações reais, problemas sociais, científicos ou culturais).

ESTRUTURA OBRIGATÓRIA PARA CADA QUESTÃO:
1. Enunciado da questão
2. Tipo de questão
3. Nível da Taxonomia de Bloom
4. Grau de dificuldade
5. Objetivo pedagógico da questão
6. Gabarito ou resposta esperada
7. Justificativa pedagógica da resposta
8. Fonte confiável utilizada (livro, artigo acadêmico, documento oficial, site institucional, etc.)

EXIGÊNCIAS ACADÊMICAS:
- As fontes DEVEM ser reais, confiáveis e verificáveis.
- Evitar fontes genéricas ou não acadêmicas.
- Não inventar referências.
- Quando aplicável, priorizar documentos curriculares oficiais, livros didáticos reconhecidos e artigos científicos.

FORMATO DE SAÍDA:
- Organizar a avaliação de forma clara, numerada e bem estruturada.
- Utilizar subtítulos.
- Manter consistência terminológica e pedagógica.

RESTRIÇÕES:
- NÃO simplificar excessivamente o conteúdo.
- NÃO gerar questões vagas ou ambíguas.
- NÃO repetir estruturas de perguntas.
- NÃO criar avaliações meramente conteudistas.

CRITÉRIO DE QUALIDADE:
A avaliação deve ser suficientemente rigorosa para diagnosticar níveis reais de aprendizagem, apoiar intervenções pedagógicas e orientar a progressão do ensino.

Agora, gere a avaliação com base nessas diretrizes.`
            },
            {
                id: 'av-diagnostica',
                icon: 'fa-user-md',
                title: 'Avaliação Diagnóstica (Sondagem)',
                description: 'Focado em pré-requisitos e lacunas de séries anteriores',
                fields: [
                    { type: 'text', name: 'etapa', label: 'Etapa de Ensino', required: true, placeholder: 'Ex: Ensino Fundamental II' },
                    { type: 'text', name: 'anoAtual', label: 'Ano/Série ATUAL do aluno', required: true, placeholder: 'Ex: 8º Ano' },
                    { type: 'text', name: 'area', label: 'Área do Conhecimento', required: true, placeholder: 'Ex: Ciências Humanas' },
                    { type: 'text', name: 'componente', label: 'Componente Curricular', required: true, placeholder: 'Ex: História' },
                    { type: 'textarea', name: 'seriesAnteriores', label: 'Série(s) ANTERIOR(ES) a sondar', required: true, placeholder: 'Obrigatório. Ex: 6º e 7º Anos (conteúdos que já deveriam saber)' },
                    { type: 'textarea', name: 'unidades', label: 'Unidades Temáticas / Objetos', placeholder: 'Ex: O mundo antigo; Feudalismo...' },
                    { type: 'text', name: 'bncc', label: 'Códigos BNCC (Séries Anteriores)', placeholder: 'Ex: (EF06HI01)...' },
                    { type: 'number', name: 'quantidade', label: 'Quantidade de Questões', required: true, placeholder: '10' },
                    { type: 'text', name: 'tipos', label: 'Tipos de Questões', placeholder: 'Ex: Múltipla escolha, Associação' },
                    { type: 'text', name: 'bloom', label: 'Distribuição Bloom', placeholder: 'Ex: 4 Compreender, 4 Aplicar (Evite Criar)' },
                    { type: 'text', name: 'dificuldade', label: 'Níveis de Dificuldade', placeholder: 'Ex: 5 Básicas, 3 Médias' },
                    { type: 'textarea', name: 'contexto', label: 'Contexto Educacional', placeholder: 'Histórico da turma...' },
                    { type: 'text', name: 'idioma', label: 'Idioma', required: true, placeholder: 'Português Brasileiro' }
                ],
                prompt: (data) => `Você é um ESPECIALISTA EM AVALIAÇÃO DIAGNÓSTICA, CURRÍCULO, BNCC E PROGRESSÃO DE APRENDIZAGENS, com domínio da Taxonomia de Bloom (revisada) e da avaliação formativa.

OBJETIVO:
Criar uma AVALIAÇÃO DE SONDAGEM (diagnóstica inicial) para verificar se os estudantes CONSTRUÍRAM os conhecimentos e habilidades essenciais das SÉRIES ANTERIORES, necessários para acompanhar a série em que estão matriculados.

A avaliação NÃO é classificatória nem punitiva. Seu foco é:
- Diagnosticar lacunas conceituais, procedimentais e cognitivas
- Identificar níveis reais de aprendizagem
- Subsidiar intervenções pedagógicas

ENTRADAS OBRIGATÓRIAS DO USUÁRIO:
1. Etapa de ensino: ${data.etapa}
2. Ano/série atual do estudante: ${data.anoAtual}
3. Área do conhecimento: ${data.area}
4. Componente curricular: ${data.componente}
5. Série(s) anterior(es) a serem sondadas: ${data.seriesAnteriores}
6. Unidade(s) temática(s) e objetos de conhecimento essenciais das séries anteriores: ${data.unidades}
7. Códigos de habilidades da BNCC (das séries anteriores): ${data.bncc}
8. Quantidade total de questões: ${data.quantidade}
9. Tipos de questões desejados: ${data.tipos}
10. Distribuição por níveis da Taxonomia de Bloom: ${data.bloom}
11. Níveis de dificuldade: ${data.dificuldade}
12. Contexto educacional: ${data.contexto}
13. Idioma da avaliação: ${data.idioma}

DIRETRIZES PEDAGÓGICAS OBRIGATÓRIAS:
- Todas as questões DEVEM avaliar habilidades da BNCC DAS SÉRIES ANTERIORES.
- As questões devem verificar se o conhecimento foi:
  → compreendido
  → aplicado
  → transferido para novas situações
- Evitar questões de memorização mecânica.
- Priorizar habilidades estruturantes (pré-requisitos reais).
- As situações-problema devem simular demandas cognitivas da série atual.

FOCO COGNITIVO:
- Lembrar (apenas quando indispensável)
- Compreender
- Aplicar
- Analisar
(NÃO utilizar “Criar” como foco principal em sondagem)

ESTRUTURA OBRIGATÓRIA DE CADA QUESTÃO:
1. Enunciado da questão
2. Tipo de questão
3. Série/ano de referência do conhecimento avaliado
4. Código(s) da habilidade da BNCC (da série anterior)
5. Nível da Taxonomia de Bloom
6. Grau de dificuldade
7. Conhecimento prévio avaliado
8. Resposta esperada / gabarito
9. Justificativa pedagógica (o que a resposta revela sobre a aprendizagem do estudante)
10. Fonte confiável (BNCC, livro didático reconhecido, documento oficial)

EXIGÊNCIAS ACADÊMICAS:
- NÃO utilizar habilidades da série atual.
- NÃO inventar códigos BNCC.
- NÃO inventar referências.
- Utilizar a BNCC como fonte principal para definição dos pré-requisitos.

FORMATO DE SAÍDA:
- Avaliação organizada, numerada e clara.
- Linguagem adequada à série atual do estudante.
- Indicar implicitamente possíveis lacunas de aprendizagem.

CRITÉRIO DE QUALIDADE:
A avaliação deve permitir ao professor identificar:
- Quais conhecimentos prévios foram consolidados
- Quais estão parcialmente construídos
- Quais não foram construídos
permitindo planejamento de recuperação, reforço ou reensino.

Agora, gere a avaliação de sondagem com base nas informações fornecidas.`
            }
        ];

        // -----------------------------------------------------
        // 2. LÓGICA DE LOGIN (HASH)
        // -----------------------------------------------------
        const HASH_U = "YXBwZXNjb2xhQGVtYWlsLmNvbQ=="; // appescola@email.com
        const HASH_P = "ZXNjb2xhYXBwMjAyNg=="; // escolaapp2026

        function handleLogin(e) {
            e.preventDefault();
            // Pega o valor sem espaços
            const email = document.getElementById('loginEmail').value.trim();
            const pass = document.getElementById('loginPass').value.trim();
            
            const loader = document.getElementById('loginLoader');
            const errorMsg = document.getElementById('loginError');
            const form = document.getElementById('loginForm');

            form.classList.add('hidden');
            loader.classList.remove('hidden');
            errorMsg.classList.add('hidden');

            setTimeout(() => {
                if (btoa(email) === HASH_U && btoa(pass) === HASH_P) {
                    sessionStorage.setItem('isLoggedIn', 'true');
                    document.getElementById('loginScreen').classList.add('hidden-screen');
                    document.getElementById('mainApp').classList.remove('hidden-screen');
                    document.getElementById('mainApp').classList.add('fade-in');
                    
                    // Limpa a busca para evitar que o navegador preencha o login lá
                    document.getElementById('searchInput').value = "";
                } else {
                    form.classList.remove('hidden');
                    errorMsg.classList.remove('hidden');
                }
                loader.classList.add('hidden');
            }, 1200);
        }
        
        function logout() {
            sessionStorage.removeItem('isLoggedIn');
            location.reload();
        }

        if(sessionStorage.getItem('isLoggedIn') === 'true') {
            document.getElementById('loginScreen').classList.add('hidden-screen');
            document.getElementById('mainApp').classList.remove('hidden-screen');
        }

        // -----------------------------------------------------
        // 3. ESTADO & UI (SIDEBAR & NAVEGAÇÃO)
        // -----------------------------------------------------
        let personalizationData = JSON.parse(localStorage.getItem('personalizationData')) || {};
        let apiConfig = JSON.parse(localStorage.getItem('apiConfig')) || { provider: 'gemini', key: '', model: '' };
        let currentGenerator = null;
        let activeLink = null;

        const sidebar = document.getElementById('sidebar');
        const overlay = document.getElementById('overlay');
        const generatorContainer = document.getElementById('generatorContainer');
        const welcomeState = document.getElementById('welcomeState');
        const toolList = document.getElementById('toolList');
        const generatorForm = document.getElementById('generatorForm');

        function toggleSidebar() {
            const isClosed = sidebar.classList.contains('-translate-x-full');
            if (isClosed) { sidebar.classList.remove('-translate-x-full'); overlay.classList.remove('hidden'); }
            else { sidebar.classList.add('-translate-x-full'); overlay.classList.add('hidden'); }
        }

        function returnToHome() {
            generatorContainer.classList.add('hidden');
            welcomeState.classList.remove('hidden');
            if (window.innerWidth < 768) { sidebar.classList.add('-translate-x-full'); overlay.classList.add('hidden'); }
            currentGenerator = null;
        }

        function renderList(filter = '') {
            toolList.innerHTML = '';
            const filtered = generators.filter(g => g.title.toLowerCase().includes(filter.toLowerCase()));
            filtered.forEach(generator => {
                const btn = document.createElement('button');
                btn.className = 'w-full text-left px-4 py-3 flex items-center gap-3 transition-all duration-200 text-sm font-medium text-gray-600 hover:bg-gray-50 hover:text-blue-700 group rounded-lg';
                btn.innerHTML = `<div class="w-10 h-10 rounded-lg bg-gray-100 flex items-center justify-center group-hover:bg-blue-100 transition-colors"><i class="fas ${generator.icon} text-gray-500 group-hover:text-blue-600"></i></div><div class="flex-1 min-w-0"><div class="font-medium truncate">${generator.title}</div><div class="text-xs text-gray-500 truncate">${generator.description}</div></div>`;
                btn.onclick = () => showGenerator(generator, btn);
                toolList.appendChild(btn);
            });
        }

        function showGenerator(generator, element) {
            currentGenerator = generator;
            // Highlight visual
            if (activeLink) { activeLink.classList.remove('bg-blue-50', 'text-blue-700', 'border-r-4', 'border-blue-600'); activeLink.classList.add('text-gray-600', 'hover:bg-gray-50'); }
            if (element) { element.classList.remove('text-gray-600', 'hover:bg-gray-50'); element.classList.add('bg-blue-50', 'text-blue-700', 'border-r-4', 'border-blue-600'); activeLink = element; }

            document.getElementById('generatorIcon').className = `fas ${generator.icon} text-2xl`;
            document.getElementById('generatorTitle').textContent = generator.title;
            document.getElementById('generatorDescription').textContent = generator.description;
            
            buildForm(generator.fields);
            
            welcomeState.classList.add('hidden');
            generatorContainer.classList.remove('hidden');
            if (window.innerWidth < 768) toggleSidebar();
        }

        function buildForm(fields) {
            generatorForm.innerHTML = '';
            fields.forEach(field => {
                const div = document.createElement('div');
                div.className = 'space-y-2';
                const label = document.createElement('label');
                label.className = 'block text-sm font-medium text-gray-700';
                label.textContent = field.label + (field.required ? ' *' : '');
                
                let input;
                if (field.type === 'select') {
                    input = document.createElement('select');
                    input.className = 'w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 bg-white';
                    const def = document.createElement('option'); def.value = ''; def.textContent = 'Selecione...'; input.appendChild(def);
                    field.options.forEach(opt => { const o = document.createElement('option'); o.value = opt; o.textContent = opt; input.appendChild(o); });
                } else if (field.type === 'textarea') {
                    input = document.createElement('textarea');
                    input.className = 'w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500';
                    input.rows = 3;
                } else {
                    input = document.createElement('input');
                    input.type = field.type;
                    input.className = 'w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500';
                }
                input.name = field.name;
                if (field.required) input.required = true;
                if (field.placeholder) input.placeholder = field.placeholder;
                div.appendChild(label); div.appendChild(input); generatorForm.appendChild(div);
            });
        }

        // -----------------------------------------------------
        // 4. API & GENERATION LOGIC
        // -----------------------------------------------------
        const resultModal = document.getElementById('resultModal');
        const loadingState = document.getElementById('loadingState');
        const aiContent = document.getElementById('aiContent');
        const loadingText = document.getElementById('loadingText');

        function updateProviderIndicator() {
            const div = document.getElementById('providerIndicator');
            const warn = document.getElementById('apiKeyWarning');
            if (apiConfig.key && apiConfig.key.length > 5) {
                div.innerHTML = `<i class="fas fa-check-circle text-emerald-500 mr-2"></i>Conectado: ${apiConfig.provider}`;
                warn.classList.add('hidden');
            } else {
                div.innerHTML = `<i class="fas fa-exclamation-circle text-yellow-500 mr-2"></i>Sem conexão`;
                warn.classList.remove('hidden');
            }
        }

        // --- PROMPT ONLY ---
        function handleGeneratePromptOnly() {
            if (!currentGenerator) return;
            const formData = new FormData(generatorForm);
            const data = {};
            for (let [key, value] of formData.entries()) data[key] = value;

            let userPrompt = currentGenerator.prompt(data);
            if (Object.keys(personalizationData).length > 0) {
                let context = "\n\nCONTEXTO DO PROFESSOR:\n";
                if(personalizationData.professorName) context += `- Nome: ${personalizationData.professorName}\n`;
                if(personalizationData.schoolName) context += `- Escola: ${personalizationData.schoolName}\n`;
                if(personalizationData.didacticUnit) context += `- Unidade: ${personalizationData.didacticUnit}\n`;
                userPrompt += context;
            }
            const fullPrompt = `${MASTER_PROMPT}\n\n${userPrompt}`;

            resultModal.classList.remove('hidden');
            loadingState.classList.add('hidden');
            aiContent.innerHTML = `
                <div class="bg-blue-50 border-l-4 border-blue-500 p-4 mb-4">
                    <p class="text-sm text-blue-700"><strong><i class="fas fa-info-circle"></i> Prompt Gerado:</strong> Copie o texto abaixo e cole na sua IA de preferência.</p>
                </div>
                <pre id="promptTextToCopy" class="whitespace-pre-wrap text-sm text-gray-800 font-mono bg-gray-50 p-4 rounded border border-gray-300 h-64 overflow-y-auto">${fullPrompt}</pre>
                <div class="mt-2 text-right">
                    <button onclick="copyToClipboard(document.getElementById('promptTextToCopy').innerText)" class="text-blue-600 text-sm font-bold uppercase"><i class="fas fa-copy"></i> Copiar Texto</button>
                </div>
            `;
        }

        // --- API GENERATE ---
        async function handleGenerate(e) {
            e.preventDefault();
            if (!currentGenerator) return;
            if (!apiConfig.key) { showApiKeyModal(); return; }

            const formData = new FormData(generatorForm);
            const data = {};
            for (let [key, value] of formData.entries()) data[key] = value;

            let userPrompt = currentGenerator.prompt(data);
            if (Object.keys(personalizationData).length > 0) {
                userPrompt += `\n\nCONTEXTO: ${personalizationData.professorName || ''}, ${personalizationData.schoolName || ''}`;
            }

            resultModal.classList.remove('hidden');
            loadingState.classList.remove('hidden');
            aiContent.innerHTML = '';
            loadingText.textContent = `Consultando ${apiConfig.provider}...`;

            try {
                let responseText = "";
                // LOGICA API COMPACTADA PARA CABER
                if (apiConfig.provider === 'gemini') {
                     const model = apiConfig.model || "gemini-1.5-flash";
                     const res = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/${model}:generateContent?key=${apiConfig.key}`, { method: 'POST', headers: {'Content-Type': 'application/json'}, body: JSON.stringify({ contents: [{ parts: [{ text: MASTER_PROMPT + "\n\n" + userPrompt }] }] }) });
                     const d = await res.json();
                     if(d.error) throw new Error(d.error.message);
                     responseText = d.candidates[0].content.parts[0].text;
                } else if (apiConfig.provider === 'groq') {
                     const model = apiConfig.model || "llama-3.3-70b-versatile";
                     const res = await fetch('https://api.groq.com/openai/v1/chat/completions', { method: 'POST', headers: {'Content-Type': 'application/json', 'Authorization': `Bearer ${apiConfig.key}`}, body: JSON.stringify({ model: model, messages: [{ role: "system", content: MASTER_PROMPT }, { role: "user", content: userPrompt }], temperature: 0.7 }) });
                     const d = await res.json();
                     if(d.error) throw new Error(d.error.message);
                     responseText = d.choices[0].message.content;
                } else if (apiConfig.provider === 'openai') {
                     const res = await fetch('https://api.openai.com/v1/chat/completions', { method: 'POST', headers: {'Content-Type': 'application/json', 'Authorization': `Bearer ${apiConfig.key}`}, body: JSON.stringify({ model: "gpt-4o-mini", messages: [{ role: "system", content: MASTER_PROMPT }, { role: "user", content: userPrompt }] }) });
                     const d = await res.json();
                     if(d.error) throw new Error(d.error.message);
                     responseText = d.choices[0].message.content;
                } else if (apiConfig.provider === 'deepseek') {
                     const res = await fetch('https://api.deepseek.com/chat/completions', { method: 'POST', headers: {'Content-Type': 'application/json', 'Authorization': `Bearer ${apiConfig.key}`}, body: JSON.stringify({ model: "deepseek-chat", messages: [{ role: "system", content: MASTER_PROMPT }, { role: "user", content: userPrompt }] }) });
                     const d = await res.json();
                     if(d.error) throw new Error(d.error.message);
                     responseText = d.choices[0].message.content;
                } else if (apiConfig.provider === 'anthropic') {
                     const res = await fetch('https://api.anthropic.com/v1/messages', { method: 'POST', headers: {'x-api-key': apiConfig.key, 'anthropic-version': '2023-06-01', 'content-type': 'application/json', 'anthropic-dangerous-direct-browser-access': 'true'}, body: JSON.stringify({ model: "claude-3-5-sonnet-20240620", max_tokens: 4000, system: MASTER_PROMPT, messages: [{ role: "user", content: userPrompt }] }) });
                     const d = await res.json();
                     if(d.error) throw new Error(d.error.message);
                     responseText = d.content[0].text;
                } else if (apiConfig.provider === 'openrouter') {
                     const res = await fetch('https://openrouter.ai/api/v1/chat/completions', { method: 'POST', headers: {'Content-Type': 'application/json', 'Authorization': `Bearer ${apiConfig.key}`, 'HTTP-Referer': window.location.href}, body: JSON.stringify({ model: apiConfig.model || "anthropic/claude-3.5-sonnet", messages: [{ role: "system", content: MASTER_PROMPT }, { role: "user", content: userPrompt }] }) });
                     const d = await res.json();
                     if(d.error) throw new Error(d.error.message);
                     responseText = d.choices[0].message.content;
                }
                
                aiContent.innerHTML = marked.parse(responseText);
            } catch (error) {
                aiContent.innerHTML = `<div class="bg-red-50 p-4 text-red-700"><strong>Erro:</strong> ${error.message}</div>`;
            } finally {
                loadingState.classList.add('hidden');
            }
        }

        // -----------------------------------------------------
        // 5. UTILS & MODALS
        // -----------------------------------------------------
        function resetForm() { generatorForm.reset(); }
        function closeModal() { document.getElementById('resultModal').classList.add('hidden'); }
        function closeMasterPrompt() { document.getElementById('masterPromptModal').classList.add('hidden'); }
        function copyToClipboard(text) { navigator.clipboard.writeText(text).then(() => alert('Copiado!')); }
        function copyContent() { copyToClipboard(aiContent.innerText); }
        
        // Tutorial
        function showTutorialModal() { document.getElementById('tutorialModal').classList.remove('hidden'); }
        function closeTutorialModal() { document.getElementById('tutorialModal').classList.add('hidden'); }
        
        // Guia Didático (Novo)
        function showGuideModal() { document.getElementById('guideModal').classList.remove('hidden'); }
        function closeGuideModal() { document.getElementById('guideModal').classList.add('hidden'); }
        
        // API Config
        function showApiKeyModal() {
            document.getElementById('apiKeyInput').value = apiConfig.key;
            document.getElementById('providerSelect').value = apiConfig.provider;
            document.getElementById('modelInput').value = apiConfig.model;
            toggleCustomFields();
            document.getElementById('apiKeyModal').classList.remove('hidden');
        }
        function toggleCustomFields() {
            const p = document.getElementById('providerSelect').value;
            const m = document.getElementById('modelInput');
            if(p === 'groq') m.value = 'llama-3.3-70b-versatile';
            else if(p === 'gemini') m.value = 'gemini-1.5-flash';
            else if(p === 'deepseek') m.value = 'deepseek-chat';
            if(['groq', 'deepseek', 'anthropic', 'openrouter', 'gemini'].includes(p)) document.getElementById('customFields').classList.remove('hidden');
            else document.getElementById('customFields').classList.add('hidden');
        }
        function saveApiConfig() {
            const p = document.getElementById('providerSelect').value;
            const k = document.getElementById('apiKeyInput').value.trim();
            const m = document.getElementById('modelInput').value.trim();
            if(!k) return alert('Chave obrigatória');
            apiConfig = { provider: p, key: k, model: m };
            localStorage.setItem('apiConfig', JSON.stringify(apiConfig));
            document.getElementById('apiKeyModal').classList.add('hidden');
            updateProviderIndicator();
            alert('Salvo!');
        }

        // Personalization
        function showPersonalizationModal() {
            const form = document.getElementById('personalizationForm');
            Object.keys(personalizationData).forEach(k => { if(form[k]) form[k].value = personalizationData[k]; });
            document.getElementById('personalizationModal').classList.remove('hidden');
        }
        function closePersonalizationModal() { document.getElementById('personalizationModal').classList.add('hidden'); }
        function savePersonalization() {
            const fd = new FormData(document.getElementById('personalizationForm'));
            personalizationData = {}; for(let [k,v] of fd) personalizationData[k] = v;
            localStorage.setItem('personalizationData', JSON.stringify(personalizationData));
            closePersonalizationModal();
        }

        // -----------------------------------------------------
        // 6. EVENT LISTENERS
        // -----------------------------------------------------
        document.getElementById('mobileMenuBtn').onclick = toggleSidebar;
        document.getElementById('closeSidebarBtn').onclick = toggleSidebar;
        document.getElementById('overlay').onclick = toggleSidebar;
        document.getElementById('searchInput').oninput = (e) => renderList(e.target.value);
        document.getElementById('generatorForm').onsubmit = handleGenerate;
        
        // PWA Install
        if ('serviceWorker' in navigator) navigator.serviceWorker.register('./service-worker.js');
        let deferredPrompt;
        const installBtn = document.getElementById('installBtn');
        window.addEventListener('beforeinstallprompt', e => { e.preventDefault(); deferredPrompt = e; installBtn.classList.remove('hidden'); });
        installBtn.onclick = async () => { if(deferredPrompt) { deferredPrompt.prompt(); const {outcome} = await deferredPrompt.userChoice; if(outcome === 'accepted') installBtn.classList.add('hidden'); } };

        // INIT
        updateProviderIndicator();
        renderList();
    </script>
</body>
</html>